(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function t(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(e){if(e.ep)return;e.ep=!0;const s=t(e);fetch(e.href,s)}})();/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function w(a,i,t,o){return new(t||(t=Promise))(function(e,s){function n(c){try{u(o.next(c))}catch(d){s(d)}}function r(c){try{u(o.throw(c))}catch(d){s(d)}}function u(c){c.done?e(c.value):new t(function(d){d(c.value)}).then(n,r)}u((o=o.apply(a,[])).next())})}function B(a,i){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},o,e,s,n;return n={next:r(0),throw:r(1),return:r(2)},typeof Symbol=="function"&&(n[Symbol.iterator]=function(){return this}),n;function r(c){return function(d){return u([c,d])}}function u(c){if(o)throw new TypeError("Generator is already executing.");for(;t;)try{if(o=1,e&&(s=c[0]&2?e.return:c[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,c[1])).done)return s;switch(e=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return t.label++,{value:c[1],done:!1};case 5:t.label++,e=c[1],c=[0];continue;case 7:c=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){t=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){t.label=c[1];break}if(c[0]===6&&t.label<s[1]){t.label=s[1],s=c;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(c);break}s[2]&&t.ops.pop(),t.trys.pop();continue}c=i.call(a,t)}catch(d){c=[6,d],e=0}finally{o=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}/**
 * @license
 * Copyright (C) 2006-2020  Music Technology Group - Universitat Pompeu Fabra
 *
 * This file is part of Essentia
 *
 * Essentia is free software: you can redistribute it and/or modify it under
 * the terms of the GNU Affero General Public License as published by the Free
 * Software Foundation (FSF), either version 3 of the License, or (at your
 * option) any later version.
 *
 * This program is distributed in the hope that it will be useful, but WITHOUT
 * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
 * details.
 *
 * You should have received a copy of the Affero GNU General Public License
 * version 3 along with this program.  If not, see http://www.gnu.org/licenses/
 */var m=function(){function a(i,t){t===void 0&&(t=!1),this.EssentiaWASM=i,this.isDebug=t,this.algorithms=new i.EssentiaJS(t),this.module=i,this.version=this.algorithms.version,this.algorithmNames=this.algorithms.algorithmNames}return a.prototype.getAudioBufferFromURL=function(i,t){return w(this,void 0,void 0,function(){var o,e,s;return B(this,function(n){switch(n.label){case 0:return[4,fetch(i)];case 1:return o=n.sent(),[4,o.arrayBuffer()];case 2:return e=n.sent(),[4,t.decodeAudioData(e)];case 3:return s=n.sent(),[2,s]}})})},a.prototype.getAudioChannelDataFromURL=function(i,t,o){return o===void 0&&(o=0),w(this,void 0,void 0,function(){var e,s,n;return B(this,function(r){switch(r.label){case 0:return[4,fetch(i)];case 1:return e=r.sent(),[4,e.arrayBuffer()];case 2:return s=r.sent(),[4,t.decodeAudioData(s)];case 3:return n=r.sent(),[2,n.getChannelData(o)]}})})},a.prototype.audioBufferToMonoSignal=function(i){if(i.numberOfChannels===1)return i.getChannelData(0);if(i.numberOfChannels===2){var t=this.arrayToVector(i.getChannelData(0)),o=this.arrayToVector(i.getChannelData(1)),e=this.MonoMixer(t,o).audio;return this.vectorToArray(e)}throw new Error("Unexpected number of channels found in audio buffer. Only accepts mono or stereo audio buffers.")},a.prototype.shutdown=function(){this.algorithms.shutdown()},a.prototype.reinstantiate=function(){this.algorithms=new this.module.EssentiaJS(this.isDebug)},a.prototype.delete=function(){this.algorithms.delete()},a.prototype.arrayToVector=function(i){return this.module.arrayToVector(i)},a.prototype.vectorToArray=function(i){return this.module.vectorToArray(i)},a.prototype.FrameGenerator=function(i,t,o){return t===void 0&&(t=2048),o===void 0&&(o=1024),this.algorithms.FrameGenerator(i,t,o)},a.prototype.MonoMixer=function(i,t){return this.algorithms.MonoMixer(i,t)},a.prototype.LoudnessEBUR128=function(i,t,o,e,s){return o===void 0&&(o=.1),e===void 0&&(e=44100),s===void 0&&(s=!1),this.algorithms.LoudnessEBUR128(i,t,o,e,s)},a.prototype.AfterMaxToBeforeMaxEnergyRatio=function(i){return this.algorithms.AfterMaxToBeforeMaxEnergyRatio(i)},a.prototype.AllPass=function(i,t,o,e,s){return t===void 0&&(t=500),o===void 0&&(o=1500),e===void 0&&(e=1),s===void 0&&(s=44100),this.algorithms.AllPass(i,t,o,e,s)},a.prototype.AudioOnsetsMarker=function(i,t,o,e){t===void 0&&(t=[]),o===void 0&&(o=44100),e===void 0&&(e="beep");for(var s=new this.module.VectorFloat,n=0;n<s.size();n++)s.push_back(t[n]);return this.algorithms.AudioOnsetsMarker(i,s,o,e)},a.prototype.AutoCorrelation=function(i,t,o,e){return t===void 0&&(t=.5),o===void 0&&(o=!1),e===void 0&&(e="standard"),this.algorithms.AutoCorrelation(i,t,o,e)},a.prototype.BFCC=function(i,t,o,e,s,n,r,u,c,d,f,h,l){return t===void 0&&(t=2),o===void 0&&(o=11e3),e===void 0&&(e=1025),s===void 0&&(s=0),n===void 0&&(n="dbamp"),r===void 0&&(r=0),u===void 0&&(u="unit_sum"),c===void 0&&(c=40),d===void 0&&(d=13),f===void 0&&(f=44100),h===void 0&&(h="power"),l===void 0&&(l="warping"),this.algorithms.BFCC(i,t,o,e,s,n,r,u,c,d,f,h,l)},a.prototype.BPF=function(i,t,o){t===void 0&&(t=[0,1]),o===void 0&&(o=[0,1]);for(var e=new this.module.VectorFloat,s=0;s<e.size();s++)e.push_back(t[s]);for(var n=new this.module.VectorFloat,s=0;s<n.size();s++)n.push_back(o[s]);return this.algorithms.BPF(i,e,n)},a.prototype.BandPass=function(i,t,o,e){return t===void 0&&(t=500),o===void 0&&(o=1500),e===void 0&&(e=44100),this.algorithms.BandPass(i,t,o,e)},a.prototype.BandReject=function(i,t,o,e){return t===void 0&&(t=500),o===void 0&&(o=1500),e===void 0&&(e=44100),this.algorithms.BandReject(i,t,o,e)},a.prototype.BarkBands=function(i,t,o){return t===void 0&&(t=27),o===void 0&&(o=44100),this.algorithms.BarkBands(i,t,o)},a.prototype.BeatTrackerDegara=function(i,t,o){return t===void 0&&(t=208),o===void 0&&(o=40),this.algorithms.BeatTrackerDegara(i,t,o)},a.prototype.BeatTrackerMultiFeature=function(i,t,o){return t===void 0&&(t=208),o===void 0&&(o=40),this.algorithms.BeatTrackerMultiFeature(i,t,o)},a.prototype.Beatogram=function(i,t,o){return o===void 0&&(o=16),this.algorithms.Beatogram(i,t,o)},a.prototype.BeatsLoudness=function(i,t,o,e,s,n){t===void 0&&(t=.05),o===void 0&&(o=.1),e===void 0&&(e=[]),s===void 0&&(s=[20,150,400,3200,7e3,22e3]),n===void 0&&(n=44100);for(var r=new this.module.VectorFloat,u=0;u<r.size();u++)r.push_back(e[u]);for(var c=new this.module.VectorFloat,u=0;u<c.size();u++)c.push_back(s[u]);return this.algorithms.BeatsLoudness(i,t,o,r,c,n)},a.prototype.BinaryOperator=function(i,t,o){return o===void 0&&(o="add"),this.algorithms.BinaryOperator(i,t,o)},a.prototype.BinaryOperatorStream=function(i,t,o){return o===void 0&&(o="add"),this.algorithms.BinaryOperatorStream(i,t,o)},a.prototype.BpmHistogramDescriptors=function(i){return this.algorithms.BpmHistogramDescriptors(i)},a.prototype.BpmRubato=function(i,t,o,e){return t===void 0&&(t=20),o===void 0&&(o=4),e===void 0&&(e=.08),this.algorithms.BpmRubato(i,t,o,e)},a.prototype.CentralMoments=function(i,t,o){return t===void 0&&(t="pdf"),o===void 0&&(o=1),this.algorithms.CentralMoments(i,t,o)},a.prototype.Centroid=function(i,t){return t===void 0&&(t=1),this.algorithms.Centroid(i,t)},a.prototype.ChordsDescriptors=function(i,t,o){return this.algorithms.ChordsDescriptors(i,t,o)},a.prototype.ChordsDetection=function(i,t,o,e){return t===void 0&&(t=2048),o===void 0&&(o=44100),e===void 0&&(e=2),this.algorithms.ChordsDetection(i,t,o,e)},a.prototype.ChordsDetectionBeats=function(i,t,o,e,s){return o===void 0&&(o="interbeat_median"),e===void 0&&(e=2048),s===void 0&&(s=44100),this.algorithms.ChordsDetectionBeats(i,t,o,e,s)},a.prototype.ChromaCrossSimilarity=function(i,t,o,e,s,n,r,u,c){return o===void 0&&(o=.095),e===void 0&&(e=9),s===void 0&&(s=1),n===void 0&&(n=12),r===void 0&&(r=!0),u===void 0&&(u=!1),c===void 0&&(c=!1),this.algorithms.ChromaCrossSimilarity(i,t,o,e,s,n,r,u,c)},a.prototype.Chromagram=function(i,t,o,e,s,n,r,u,c,d,f){return t===void 0&&(t=12),o===void 0&&(o=32.7),e===void 0&&(e=4),s===void 0&&(s="unit_max"),n===void 0&&(n=84),r===void 0&&(r=44100),u===void 0&&(u=1),c===void 0&&(c=.01),d===void 0&&(d="hann"),f===void 0&&(f=!0),this.algorithms.Chromagram(i,t,o,e,s,n,r,u,c,d,f)},a.prototype.ClickDetector=function(i,t,o,e,s,n,r,u){return t===void 0&&(t=30),o===void 0&&(o=512),e===void 0&&(e=256),s===void 0&&(s=12),n===void 0&&(n=10),r===void 0&&(r=44100),u===void 0&&(u=-50),this.algorithms.ClickDetector(i,t,o,e,s,n,r,u)},a.prototype.Clipper=function(i,t,o){return t===void 0&&(t=1),o===void 0&&(o=-1),this.algorithms.Clipper(i,t,o)},a.prototype.CoverSongSimilarity=function(i,t,o,e,s){return t===void 0&&(t="serra09"),o===void 0&&(o=.5),e===void 0&&(e=.5),s===void 0&&(s="asymmetric"),this.algorithms.CoverSongSimilarity(i,t,o,e,s)},a.prototype.Crest=function(i){return this.algorithms.Crest(i)},a.prototype.CrossCorrelation=function(i,t,o,e){return o===void 0&&(o=1),e===void 0&&(e=0),this.algorithms.CrossCorrelation(i,t,o,e)},a.prototype.CrossSimilarityMatrix=function(i,t,o,e,s,n){return o===void 0&&(o=!1),e===void 0&&(e=.095),s===void 0&&(s=1),n===void 0&&(n=1),this.algorithms.CrossSimilarityMatrix(i,t,o,e,s,n)},a.prototype.CubicSpline=function(i,t,o,e,s,n,r){t===void 0&&(t=0),o===void 0&&(o=0),e===void 0&&(e=0),s===void 0&&(s=0),n===void 0&&(n=[0,1]),r===void 0&&(r=[0,1]);for(var u=new this.module.VectorFloat,c=0;c<u.size();c++)u.push_back(n[c]);for(var d=new this.module.VectorFloat,c=0;c<d.size();c++)d.push_back(r[c]);return this.algorithms.CubicSpline(i,t,o,e,s,u,d)},a.prototype.DCRemoval=function(i,t,o){return t===void 0&&(t=40),o===void 0&&(o=44100),this.algorithms.DCRemoval(i,t,o)},a.prototype.DCT=function(i,t,o,e,s){return t===void 0&&(t=2),o===void 0&&(o=10),e===void 0&&(e=0),s===void 0&&(s=10),this.algorithms.DCT(i,t,o,e,s)},a.prototype.Danceability=function(i,t,o,e,s){return t===void 0&&(t=8800),o===void 0&&(o=310),e===void 0&&(e=44100),s===void 0&&(s=1.1),this.algorithms.Danceability(i,t,o,e,s)},a.prototype.Decrease=function(i,t){return t===void 0&&(t=1),this.algorithms.Decrease(i,t)},a.prototype.Derivative=function(i){return this.algorithms.Derivative(i)},a.prototype.DerivativeSFX=function(i){return this.algorithms.DerivativeSFX(i)},a.prototype.DiscontinuityDetector=function(i,t,o,e,s,n,r,u,c){return t===void 0&&(t=8),o===void 0&&(o=-60),e===void 0&&(e=512),s===void 0&&(s=256),n===void 0&&(n=7),r===void 0&&(r=3),u===void 0&&(u=-50),c===void 0&&(c=32),this.algorithms.DiscontinuityDetector(i,t,o,e,s,n,r,u,c)},a.prototype.Dissonance=function(i,t){return this.algorithms.Dissonance(i,t)},a.prototype.DistributionShape=function(i){return this.algorithms.DistributionShape(i)},a.prototype.Duration=function(i,t){return t===void 0&&(t=44100),this.algorithms.Duration(i,t)},a.prototype.DynamicComplexity=function(i,t,o){return t===void 0&&(t=.2),o===void 0&&(o=44100),this.algorithms.DynamicComplexity(i,t,o)},a.prototype.ERBBands=function(i,t,o,e,s,n,r,u){return t===void 0&&(t=22050),o===void 0&&(o=1025),e===void 0&&(e=50),s===void 0&&(s=40),n===void 0&&(n=44100),r===void 0&&(r="power"),u===void 0&&(u=1),this.algorithms.ERBBands(i,t,o,e,s,n,r,u)},a.prototype.EffectiveDuration=function(i,t,o){return t===void 0&&(t=44100),o===void 0&&(o=.4),this.algorithms.EffectiveDuration(i,t,o)},a.prototype.Energy=function(i){return this.algorithms.Energy(i)},a.prototype.EnergyBand=function(i,t,o,e){return t===void 0&&(t=44100),o===void 0&&(o=0),e===void 0&&(e=100),this.algorithms.EnergyBand(i,t,o,e)},a.prototype.EnergyBandRatio=function(i,t,o,e){return t===void 0&&(t=44100),o===void 0&&(o=0),e===void 0&&(e=100),this.algorithms.EnergyBandRatio(i,t,o,e)},a.prototype.Entropy=function(i){return this.algorithms.Entropy(i)},a.prototype.Envelope=function(i,t,o,e,s){return t===void 0&&(t=!0),o===void 0&&(o=10),e===void 0&&(e=1500),s===void 0&&(s=44100),this.algorithms.Envelope(i,t,o,e,s)},a.prototype.EqualLoudness=function(i,t){return t===void 0&&(t=44100),this.algorithms.EqualLoudness(i,t)},a.prototype.Flatness=function(i){return this.algorithms.Flatness(i)},a.prototype.FlatnessDB=function(i){return this.algorithms.FlatnessDB(i)},a.prototype.FlatnessSFX=function(i){return this.algorithms.FlatnessSFX(i)},a.prototype.Flux=function(i,t,o){return t===void 0&&(t=!1),o===void 0&&(o="L2"),this.algorithms.Flux(i,t,o)},a.prototype.FrameCutter=function(i,t,o,e,s,n){return t===void 0&&(t=1024),o===void 0&&(o=512),e===void 0&&(e=!1),s===void 0&&(s=!1),n===void 0&&(n=0),this.algorithms.FrameCutter(i,t,o,e,s,n)},a.prototype.FrameToReal=function(i,t,o){return t===void 0&&(t=2048),o===void 0&&(o=128),this.algorithms.FrameToReal(i,t,o)},a.prototype.FrequencyBands=function(i,t,o){t===void 0&&(t=[0,50,100,150,200,300,400,510,630,770,920,1080,1270,1480,1720,2e3,2320,2700,3150,3700,4400,5300,6400,7700,9500,12e3,15500,20500,27e3]),o===void 0&&(o=44100);for(var e=new this.module.VectorFloat,s=0;s<e.size();s++)e.push_back(t[s]);return this.algorithms.FrequencyBands(i,e,o)},a.prototype.GFCC=function(i,t,o,e,s,n,r,u,c,d,f){return t===void 0&&(t=2),o===void 0&&(o=22050),e===void 0&&(e=1025),s===void 0&&(s="dbamp"),n===void 0&&(n=40),r===void 0&&(r=40),u===void 0&&(u=13),c===void 0&&(c=44100),d===void 0&&(d=1e-10),f===void 0&&(f="power"),this.algorithms.GFCC(i,t,o,e,s,n,r,u,c,d,f)},a.prototype.GapsDetector=function(i,t,o,e,s,n,r,u,c,d,f,h,l){return t===void 0&&(t=.05),o===void 0&&(o=2048),e===void 0&&(e=1024),s===void 0&&(s=11),n===void 0&&(n=3500),r===void 0&&(r=10),u===void 0&&(u=40),c===void 0&&(c=-30),d===void 0&&(d=40),f===void 0&&(f=.05),h===void 0&&(h=44100),l===void 0&&(l=-50),this.algorithms.GapsDetector(i,t,o,e,s,n,r,u,c,d,f,h,l)},a.prototype.GeometricMean=function(i){return this.algorithms.GeometricMean(i)},a.prototype.HFC=function(i,t,o){return t===void 0&&(t=44100),o===void 0&&(o="Masri"),this.algorithms.HFC(i,t,o)},a.prototype.HPCP=function(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g){return o===void 0&&(o=!0),e===void 0&&(e=500),s===void 0&&(s=0),n===void 0&&(n=5e3),r===void 0&&(r=!1),u===void 0&&(u=40),c===void 0&&(c=!1),d===void 0&&(d="unitMax"),f===void 0&&(f=440),h===void 0&&(h=44100),l===void 0&&(l=12),v===void 0&&(v="squaredCosine"),g===void 0&&(g=1),this.algorithms.HPCP(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g)},a.prototype.HarmonicBpm=function(i,t,o,e){return t===void 0&&(t=60),o===void 0&&(o=20),e===void 0&&(e=5),this.algorithms.HarmonicBpm(i,t,o,e)},a.prototype.HarmonicPeaks=function(i,t,o,e,s){return e===void 0&&(e=20),s===void 0&&(s=.2),this.algorithms.HarmonicPeaks(i,t,o,e,s)},a.prototype.HighPass=function(i,t,o){return t===void 0&&(t=1500),o===void 0&&(o=44100),this.algorithms.HighPass(i,t,o)},a.prototype.HighResolutionFeatures=function(i,t){return t===void 0&&(t=24),this.algorithms.HighResolutionFeatures(i,t)},a.prototype.Histogram=function(i,t,o,e,s){return t===void 0&&(t=1),o===void 0&&(o=0),e===void 0&&(e="none"),s===void 0&&(s=10),this.algorithms.Histogram(i,t,o,e,s)},a.prototype.HprModelAnal=function(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g,y){return o===void 0&&(o=2048),e===void 0&&(e=20),s===void 0&&(s=.01),n===void 0&&(n=.01),r===void 0&&(r=512),u===void 0&&(u=0),c===void 0&&(c=5e3),d===void 0&&(d=100),f===void 0&&(f=100),h===void 0&&(h=20),l===void 0&&(l=100),v===void 0&&(v="frequency"),g===void 0&&(g=44100),y===void 0&&(y=.2),this.algorithms.HprModelAnal(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g,y)},a.prototype.HpsModelAnal=function(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g,y){return o===void 0&&(o=2048),e===void 0&&(e=20),s===void 0&&(s=.01),n===void 0&&(n=.01),r===void 0&&(r=512),u===void 0&&(u=0),c===void 0&&(c=5e3),d===void 0&&(d=100),f===void 0&&(f=100),h===void 0&&(h=20),l===void 0&&(l=100),v===void 0&&(v="frequency"),g===void 0&&(g=44100),y===void 0&&(y=.2),this.algorithms.HpsModelAnal(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g,y)},a.prototype.IDCT=function(i,t,o,e,s){return t===void 0&&(t=2),o===void 0&&(o=10),e===void 0&&(e=0),s===void 0&&(s=10),this.algorithms.IDCT(i,t,o,e,s)},a.prototype.IIR=function(i,t,o){t===void 0&&(t=[1]),o===void 0&&(o=[1]);for(var e=new this.module.VectorFloat,s=0;s<e.size();s++)e.push_back(t[s]);for(var n=new this.module.VectorFloat,s=0;s<n.size();s++)n.push_back(o[s]);return this.algorithms.IIR(i,e,n)},a.prototype.Inharmonicity=function(i,t){return this.algorithms.Inharmonicity(i,t)},a.prototype.InstantPower=function(i){return this.algorithms.InstantPower(i)},a.prototype.Intensity=function(i,t){return t===void 0&&(t=44100),this.algorithms.Intensity(i,t)},a.prototype.Key=function(i,t,o,e,s,n,r,u){return t===void 0&&(t=4),o===void 0&&(o=36),e===void 0&&(e="bgate"),s===void 0&&(s=.6),n===void 0&&(n=!1),r===void 0&&(r=!0),u===void 0&&(u=!0),this.algorithms.Key(i,t,o,e,s,n,r,u)},a.prototype.KeyExtractor=function(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g){return t===void 0&&(t=!0),o===void 0&&(o=4096),e===void 0&&(e=4096),s===void 0&&(s=12),n===void 0&&(n=3500),r===void 0&&(r=60),u===void 0&&(u=25),c===void 0&&(c=.2),d===void 0&&(d="bgate"),f===void 0&&(f=44100),h===void 0&&(h=1e-4),l===void 0&&(l=440),v===void 0&&(v="cosine"),g===void 0&&(g="hann"),this.algorithms.KeyExtractor(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g)},a.prototype.LPC=function(i,t,o,e){return t===void 0&&(t=10),o===void 0&&(o=44100),e===void 0&&(e="regular"),this.algorithms.LPC(i,t,o,e)},a.prototype.Larm=function(i,t,o,e,s){return t===void 0&&(t=10),o===void 0&&(o=1.5),e===void 0&&(e=1500),s===void 0&&(s=44100),this.algorithms.Larm(i,t,o,e,s)},a.prototype.Leq=function(i){return this.algorithms.Leq(i)},a.prototype.LevelExtractor=function(i,t,o){return t===void 0&&(t=88200),o===void 0&&(o=44100),this.algorithms.LevelExtractor(i,t,o)},a.prototype.LogAttackTime=function(i,t,o,e){return t===void 0&&(t=44100),o===void 0&&(o=.2),e===void 0&&(e=.9),this.algorithms.LogAttackTime(i,t,o,e)},a.prototype.LogSpectrum=function(i,t,o,e,s){return t===void 0&&(t=3),o===void 0&&(o=1025),e===void 0&&(e=0),s===void 0&&(s=44100),this.algorithms.LogSpectrum(i,t,o,e,s)},a.prototype.LoopBpmConfidence=function(i,t,o){return o===void 0&&(o=44100),this.algorithms.LoopBpmConfidence(i,t,o)},a.prototype.LoopBpmEstimator=function(i,t){return t===void 0&&(t=.95),this.algorithms.LoopBpmEstimator(i,t)},a.prototype.Loudness=function(i){return this.algorithms.Loudness(i)},a.prototype.LoudnessVickers=function(i,t){return t===void 0&&(t=44100),this.algorithms.LoudnessVickers(i,t)},a.prototype.LowLevelSpectralEqloudExtractor=function(i,t,o,e){return t===void 0&&(t=2048),o===void 0&&(o=1024),e===void 0&&(e=44100),this.algorithms.LowLevelSpectralEqloudExtractor(i,t,o,e)},a.prototype.LowLevelSpectralExtractor=function(i,t,o,e){return t===void 0&&(t=2048),o===void 0&&(o=1024),e===void 0&&(e=44100),this.algorithms.LowLevelSpectralExtractor(i,t,o,e)},a.prototype.LowPass=function(i,t,o){return t===void 0&&(t=1500),o===void 0&&(o=44100),this.algorithms.LowPass(i,t,o)},a.prototype.MFCC=function(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g){return t===void 0&&(t=2),o===void 0&&(o=11e3),e===void 0&&(e=1025),s===void 0&&(s=0),n===void 0&&(n="dbamp"),r===void 0&&(r=0),u===void 0&&(u="unit_sum"),c===void 0&&(c=40),d===void 0&&(d=13),f===void 0&&(f=44100),h===void 0&&(h=1e-10),l===void 0&&(l="power"),v===void 0&&(v="htkMel"),g===void 0&&(g="warping"),this.algorithms.MFCC(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g)},a.prototype.MaxFilter=function(i,t,o){return t===void 0&&(t=!0),o===void 0&&(o=3),this.algorithms.MaxFilter(i,t,o)},a.prototype.MaxMagFreq=function(i,t){return t===void 0&&(t=44100),this.algorithms.MaxMagFreq(i,t)},a.prototype.MaxToTotal=function(i){return this.algorithms.MaxToTotal(i)},a.prototype.Mean=function(i){return this.algorithms.Mean(i)},a.prototype.Median=function(i){return this.algorithms.Median(i)},a.prototype.MedianFilter=function(i,t){return t===void 0&&(t=11),this.algorithms.MedianFilter(i,t)},a.prototype.MelBands=function(i,t,o,e,s,n,r,u,c,d,f){return t===void 0&&(t=22050),o===void 0&&(o=1025),e===void 0&&(e=!1),s===void 0&&(s=0),n===void 0&&(n="unit_sum"),r===void 0&&(r=24),u===void 0&&(u=44100),c===void 0&&(c="power"),d===void 0&&(d="htkMel"),f===void 0&&(f="warping"),this.algorithms.MelBands(i,t,o,e,s,n,r,u,c,d,f)},a.prototype.Meter=function(i){return this.algorithms.Meter(i)},a.prototype.MinMax=function(i,t){return t===void 0&&(t="min"),this.algorithms.MinMax(i,t)},a.prototype.MinToTotal=function(i){return this.algorithms.MinToTotal(i)},a.prototype.MovingAverage=function(i,t){return t===void 0&&(t=6),this.algorithms.MovingAverage(i,t)},a.prototype.MultiPitchKlapuri=function(i,t,o,e,s,n,r,u,c,d,f,h){return t===void 0&&(t=10),o===void 0&&(o=2048),e===void 0&&(e=.8),s===void 0&&(s=128),n===void 0&&(n=1),r===void 0&&(r=40),u===void 0&&(u=1760),c===void 0&&(c=80),d===void 0&&(d=10),f===void 0&&(f=55),h===void 0&&(h=44100),this.algorithms.MultiPitchKlapuri(i,t,o,e,s,n,r,u,c,d,f,h)},a.prototype.MultiPitchMelodia=function(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g,y,p,C,M){return t===void 0&&(t=10),o===void 0&&(o=3),e===void 0&&(e=2048),s===void 0&&(s=!1),n===void 0&&(n=.8),r===void 0&&(r=128),u===void 0&&(u=1),c===void 0&&(c=40),d===void 0&&(d=2e4),f===void 0&&(f=100),h===void 0&&(h=40),l===void 0&&(l=20),v===void 0&&(v=.9),g===void 0&&(g=.9),y===void 0&&(y=27.5625),p===void 0&&(p=55),C===void 0&&(C=44100),M===void 0&&(M=100),this.algorithms.MultiPitchMelodia(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g,y,p,C,M)},a.prototype.Multiplexer=function(i,t){return i===void 0&&(i=0),t===void 0&&(t=0),this.algorithms.Multiplexer(i,t)},a.prototype.NNLSChroma=function(i,t,o,e,s,n,r,u,c,d){return e===void 0&&(e="none"),s===void 0&&(s=1025),n===void 0&&(n=44100),r===void 0&&(r=.7),u===void 0&&(u=1),c===void 0&&(c="global"),d===void 0&&(d=!0),this.algorithms.NNLSChroma(i,t,o,e,s,n,r,u,c,d)},a.prototype.NoiseAdder=function(i,t,o){return t===void 0&&(t=!1),o===void 0&&(o=-100),this.algorithms.NoiseAdder(i,t,o)},a.prototype.NoiseBurstDetector=function(i,t,o,e){return t===void 0&&(t=.9),o===void 0&&(o=-50),e===void 0&&(e=8),this.algorithms.NoiseBurstDetector(i,t,o,e)},a.prototype.NoveltyCurve=function(i,t,o,e,s){t===void 0&&(t=344.531),o===void 0&&(o=!1),e===void 0&&(e=[]),s===void 0&&(s="hybrid");for(var n=new this.module.VectorFloat,r=0;r<n.size();r++)n.push_back(e[r]);return this.algorithms.NoveltyCurve(i,t,o,n,s)},a.prototype.NoveltyCurveFixedBpmEstimator=function(i,t,o,e,s,n){return t===void 0&&(t=512),o===void 0&&(o=560),e===void 0&&(e=30),s===void 0&&(s=44100),n===void 0&&(n=3),this.algorithms.NoveltyCurveFixedBpmEstimator(i,t,o,e,s,n)},a.prototype.OddToEvenHarmonicEnergyRatio=function(i,t){return this.algorithms.OddToEvenHarmonicEnergyRatio(i,t)},a.prototype.OnsetDetection=function(i,t,o,e){return o===void 0&&(o="hfc"),e===void 0&&(e=44100),this.algorithms.OnsetDetection(i,t,o,e)},a.prototype.OnsetDetectionGlobal=function(i,t,o,e,s){return t===void 0&&(t=2048),o===void 0&&(o=512),e===void 0&&(e="infogain"),s===void 0&&(s=44100),this.algorithms.OnsetDetectionGlobal(i,t,o,e,s)},a.prototype.OnsetRate=function(i){return this.algorithms.OnsetRate(i)},a.prototype.OverlapAdd=function(i,t,o,e){return t===void 0&&(t=2048),o===void 0&&(o=1),e===void 0&&(e=128),this.algorithms.OverlapAdd(i,t,o,e)},a.prototype.PeakDetection=function(i,t,o,e,s,n,r,u,c){return t===void 0&&(t=!0),o===void 0&&(o=100),e===void 0&&(e=1),s===void 0&&(s=0),n===void 0&&(n=0),r===void 0&&(r="position"),u===void 0&&(u=1),c===void 0&&(c=-1e6),this.algorithms.PeakDetection(i,t,o,e,s,n,r,u,c)},a.prototype.PercivalBpmEstimator=function(i,t,o,e,s,n,r,u){return t===void 0&&(t=1024),o===void 0&&(o=2048),e===void 0&&(e=128),s===void 0&&(s=128),n===void 0&&(n=210),r===void 0&&(r=50),u===void 0&&(u=44100),this.algorithms.PercivalBpmEstimator(i,t,o,e,s,n,r,u)},a.prototype.PercivalEnhanceHarmonics=function(i){return this.algorithms.PercivalEnhanceHarmonics(i)},a.prototype.PercivalEvaluatePulseTrains=function(i,t){return this.algorithms.PercivalEvaluatePulseTrains(i,t)},a.prototype.PitchContourSegmentation=function(i,t,o,e,s,n,r,u){return o===void 0&&(o=128),e===void 0&&(e=.1),s===void 0&&(s=60),n===void 0&&(n=-2),r===void 0&&(r=44100),u===void 0&&(u=440),this.algorithms.PitchContourSegmentation(i,t,o,e,s,n,r,u)},a.prototype.PitchContours=function(i,t,o,e,s,n,r,u,c,d){return o===void 0&&(o=10),e===void 0&&(e=128),s===void 0&&(s=100),n===void 0&&(n=.9),r===void 0&&(r=.9),u===void 0&&(u=27.5625),c===void 0&&(c=44100),d===void 0&&(d=100),this.algorithms.PitchContours(i,t,o,e,s,n,r,u,c,d)},a.prototype.PitchContoursMelody=function(i,t,o,e,s,n,r,u,c,d,f,h,l,v){return s===void 0&&(s=10),n===void 0&&(n=3),r===void 0&&(r=!1),u===void 0&&(u=128),c===void 0&&(c=2e4),d===void 0&&(d=80),f===void 0&&(f=55),h===void 0&&(h=44100),l===void 0&&(l=!1),v===void 0&&(v=.2),this.algorithms.PitchContoursMelody(i,t,o,e,s,n,r,u,c,d,f,h,l,v)},a.prototype.PitchContoursMonoMelody=function(i,t,o,e,s,n,r,u,c,d,f,h){return s===void 0&&(s=10),n===void 0&&(n=3),r===void 0&&(r=!1),u===void 0&&(u=128),c===void 0&&(c=2e4),d===void 0&&(d=80),f===void 0&&(f=55),h===void 0&&(h=44100),this.algorithms.PitchContoursMonoMelody(i,t,o,e,s,n,r,u,c,d,f,h)},a.prototype.PitchContoursMultiMelody=function(i,t,o,e,s,n,r,u,c,d,f,h){return s===void 0&&(s=10),n===void 0&&(n=3),r===void 0&&(r=!1),u===void 0&&(u=128),c===void 0&&(c=2e4),d===void 0&&(d=80),f===void 0&&(f=55),h===void 0&&(h=44100),this.algorithms.PitchContoursMultiMelody(i,t,o,e,s,n,r,u,c,d,f,h)},a.prototype.PitchFilter=function(i,t,o,e,s){return o===void 0&&(o=36),e===void 0&&(e=30),s===void 0&&(s=!1),this.algorithms.PitchFilter(i,t,o,e,s)},a.prototype.PitchMelodia=function(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g,y,p,C,M){return t===void 0&&(t=10),o===void 0&&(o=3),e===void 0&&(e=2048),s===void 0&&(s=!1),n===void 0&&(n=.8),r===void 0&&(r=128),u===void 0&&(u=1),c===void 0&&(c=40),d===void 0&&(d=2e4),f===void 0&&(f=100),h===void 0&&(h=40),l===void 0&&(l=20),v===void 0&&(v=.9),g===void 0&&(g=.9),y===void 0&&(y=27.5625),p===void 0&&(p=55),C===void 0&&(C=44100),M===void 0&&(M=100),this.algorithms.PitchMelodia(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g,y,p,C,M)},a.prototype.PitchSalience=function(i,t,o,e){return t===void 0&&(t=5e3),o===void 0&&(o=100),e===void 0&&(e=44100),this.algorithms.PitchSalience(i,t,o,e)},a.prototype.PitchSalienceFunction=function(i,t,o,e,s,n,r,u){return o===void 0&&(o=10),e===void 0&&(e=.8),s===void 0&&(s=1),n===void 0&&(n=40),r===void 0&&(r=20),u===void 0&&(u=55),this.algorithms.PitchSalienceFunction(i,t,o,e,s,n,r,u)},a.prototype.PitchSalienceFunctionPeaks=function(i,t,o,e,s){return t===void 0&&(t=10),o===void 0&&(o=1760),e===void 0&&(e=55),s===void 0&&(s=55),this.algorithms.PitchSalienceFunctionPeaks(i,t,o,e,s)},a.prototype.PitchYin=function(i,t,o,e,s,n,r){return t===void 0&&(t=2048),o===void 0&&(o=!0),e===void 0&&(e=22050),s===void 0&&(s=20),n===void 0&&(n=44100),r===void 0&&(r=.15),this.algorithms.PitchYin(i,t,o,e,s,n,r)},a.prototype.PitchYinFFT=function(i,t,o,e,s,n,r){return t===void 0&&(t=2048),o===void 0&&(o=!0),e===void 0&&(e=22050),s===void 0&&(s=20),n===void 0&&(n=44100),r===void 0&&(r=1),this.algorithms.PitchYinFFT(i,t,o,e,s,n,r)},a.prototype.PitchYinProbabilistic=function(i,t,o,e,s,n,r){return t===void 0&&(t=2048),o===void 0&&(o=256),e===void 0&&(e=.1),s===void 0&&(s="negative"),n===void 0&&(n=!1),r===void 0&&(r=44100),this.algorithms.PitchYinProbabilistic(i,t,o,e,s,n,r)},a.prototype.PitchYinProbabilities=function(i,t,o,e,s){return t===void 0&&(t=2048),o===void 0&&(o=.1),e===void 0&&(e=!1),s===void 0&&(s=44100),this.algorithms.PitchYinProbabilities(i,t,o,e,s)},a.prototype.PitchYinProbabilitiesHMM=function(i,t,o,e,s,n){return o===void 0&&(o=61.735),e===void 0&&(e=5),s===void 0&&(s=.99),n===void 0&&(n=.5),this.algorithms.PitchYinProbabilitiesHMM(i,t,o,e,s,n)},a.prototype.PowerMean=function(i,t){return t===void 0&&(t=1),this.algorithms.PowerMean(i,t)},a.prototype.PowerSpectrum=function(i,t){return t===void 0&&(t=2048),this.algorithms.PowerSpectrum(i,t)},a.prototype.PredominantPitchMelodia=function(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g,y,p,C,M,E,D){return t===void 0&&(t=10),o===void 0&&(o=3),e===void 0&&(e=2048),s===void 0&&(s=!1),n===void 0&&(n=.8),r===void 0&&(r=128),u===void 0&&(u=1),c===void 0&&(c=40),d===void 0&&(d=2e4),f===void 0&&(f=100),h===void 0&&(h=80),l===void 0&&(l=20),v===void 0&&(v=.9),g===void 0&&(g=.9),y===void 0&&(y=27.5625),p===void 0&&(p=55),C===void 0&&(C=44100),M===void 0&&(M=100),E===void 0&&(E=!1),D===void 0&&(D=.2),this.algorithms.PredominantPitchMelodia(i,t,o,e,s,n,r,u,c,d,f,h,l,v,g,y,p,C,M,E,D)},a.prototype.RMS=function(i){return this.algorithms.RMS(i)},a.prototype.RawMoments=function(i,t){return t===void 0&&(t=22050),this.algorithms.RawMoments(i,t)},a.prototype.ReplayGain=function(i,t){return t===void 0&&(t=44100),this.algorithms.ReplayGain(i,t)},a.prototype.Resample=function(i,t,o,e){return t===void 0&&(t=44100),o===void 0&&(o=44100),e===void 0&&(e=1),this.algorithms.Resample(i,t,o,e)},a.prototype.ResampleFFT=function(i,t,o){return t===void 0&&(t=128),o===void 0&&(o=128),this.algorithms.ResampleFFT(i,t,o)},a.prototype.RhythmDescriptors=function(i){return this.algorithms.RhythmDescriptors(i)},a.prototype.RhythmExtractor=function(i,t,o,e,s,n,r,u,c,d,f,h,l){t===void 0&&(t=1024),o===void 0&&(o=1024),e===void 0&&(e=256),s===void 0&&(s=.1),n===void 0&&(n=208),r===void 0&&(r=40),u===void 0&&(u=1024),c===void 0&&(c=44100),d===void 0&&(d=[]),f===void 0&&(f=.24),h===void 0&&(h=!0),l===void 0&&(l=!0);for(var v=new this.module.VectorFloat,g=0;g<v.size();g++)v.push_back(d[g]);return this.algorithms.RhythmExtractor(i,t,o,e,s,n,r,u,c,v,f,h,l)},a.prototype.RhythmExtractor2013=function(i,t,o,e){return t===void 0&&(t=208),o===void 0&&(o="multifeature"),e===void 0&&(e=40),this.algorithms.RhythmExtractor2013(i,t,o,e)},a.prototype.RhythmTransform=function(i,t,o){return t===void 0&&(t=256),o===void 0&&(o=32),this.algorithms.RhythmTransform(i,t,o)},a.prototype.RollOff=function(i,t,o){return t===void 0&&(t=.85),o===void 0&&(o=44100),this.algorithms.RollOff(i,t,o)},a.prototype.SNR=function(i,t,o,e,s,n,r,u){return t===void 0&&(t=.95),o===void 0&&(o=.98),e===void 0&&(e=.9),s===void 0&&(s=512),n===void 0&&(n=-40),r===void 0&&(r=44100),u===void 0&&(u=!0),this.algorithms.SNR(i,t,o,e,s,n,r,u)},a.prototype.SaturationDetector=function(i,t,o,e,s,n,r){return t===void 0&&(t=.001),o===void 0&&(o=-1),e===void 0&&(e=512),s===void 0&&(s=256),n===void 0&&(n=.005),r===void 0&&(r=44100),this.algorithms.SaturationDetector(i,t,o,e,s,n,r)},a.prototype.Scale=function(i,t,o,e){return t===void 0&&(t=!0),o===void 0&&(o=10),e===void 0&&(e=1),this.algorithms.Scale(i,t,o,e)},a.prototype.SineSubtraction=function(i,t,o,e,s,n,r){return s===void 0&&(s=512),n===void 0&&(n=128),r===void 0&&(r=44100),this.algorithms.SineSubtraction(i,t,o,e,s,n,r)},a.prototype.SingleBeatLoudness=function(i,t,o,e,s,n){t===void 0&&(t=.05),o===void 0&&(o=.1),e===void 0&&(e=[0,200,400,800,1600,3200,22e3]),s===void 0&&(s="sumEnergy"),n===void 0&&(n=44100);for(var r=new this.module.VectorFloat,u=0;u<r.size();u++)r.push_back(e[u]);return this.algorithms.SingleBeatLoudness(i,t,o,r,s,n)},a.prototype.Slicer=function(i,t,o,e,s){t===void 0&&(t=[]),o===void 0&&(o=44100),e===void 0&&(e=[]),s===void 0&&(s="seconds");for(var n=new this.module.VectorFloat,r=0;r<n.size();r++)n.push_back(t[r]);for(var u=new this.module.VectorFloat,r=0;r<u.size();r++)u.push_back(e[r]);return this.algorithms.Slicer(i,n,o,u,s)},a.prototype.SpectralCentroidTime=function(i,t){return t===void 0&&(t=44100),this.algorithms.SpectralCentroidTime(i,t)},a.prototype.SpectralComplexity=function(i,t,o){return t===void 0&&(t=.005),o===void 0&&(o=44100),this.algorithms.SpectralComplexity(i,t,o)},a.prototype.SpectralContrast=function(i,t,o,e,s,n,r,u){return t===void 0&&(t=2048),o===void 0&&(o=11e3),e===void 0&&(e=20),s===void 0&&(s=.4),n===void 0&&(n=6),r===void 0&&(r=22050),u===void 0&&(u=.15),this.algorithms.SpectralContrast(i,t,o,e,s,n,r,u)},a.prototype.SpectralPeaks=function(i,t,o,e,s,n,r){return t===void 0&&(t=0),o===void 0&&(o=5e3),e===void 0&&(e=100),s===void 0&&(s=0),n===void 0&&(n="frequency"),r===void 0&&(r=44100),this.algorithms.SpectralPeaks(i,t,o,e,s,n,r)},a.prototype.SpectralWhitening=function(i,t,o,e,s){return e===void 0&&(e=5e3),s===void 0&&(s=44100),this.algorithms.SpectralWhitening(i,t,o,e,s)},a.prototype.Spectrum=function(i,t){return t===void 0&&(t=2048),this.algorithms.Spectrum(i,t)},a.prototype.SpectrumCQ=function(i,t,o,e,s,n,r,u,c,d){return t===void 0&&(t=12),o===void 0&&(o=32.7),e===void 0&&(e=4),s===void 0&&(s=84),n===void 0&&(n=44100),r===void 0&&(r=1),u===void 0&&(u=.01),c===void 0&&(c="hann"),d===void 0&&(d=!0),this.algorithms.SpectrumCQ(i,t,o,e,s,n,r,u,c,d)},a.prototype.SpectrumToCent=function(i,t,o,e,s,n,r,u,c){return t===void 0&&(t=720),o===void 0&&(o=10),e===void 0&&(e=32768),s===void 0&&(s=!0),n===void 0&&(n=164),r===void 0&&(r="unit_sum"),u===void 0&&(u=44100),c===void 0&&(c="power"),this.algorithms.SpectrumToCent(i,t,o,e,s,n,r,u,c)},a.prototype.Spline=function(i,t,o,e,s,n){t===void 0&&(t=1),o===void 0&&(o=0),e===void 0&&(e="b"),s===void 0&&(s=[0,1]),n===void 0&&(n=[0,1]);for(var r=new this.module.VectorFloat,u=0;u<r.size();u++)r.push_back(s[u]);for(var c=new this.module.VectorFloat,u=0;u<c.size();u++)c.push_back(n[u]);return this.algorithms.Spline(i,t,o,e,r,c)},a.prototype.SprModelAnal=function(i,t,o,e,s,n,r,u,c,d,f,h){return t===void 0&&(t=2048),o===void 0&&(o=20),e===void 0&&(e=.01),s===void 0&&(s=512),n===void 0&&(n=0),r===void 0&&(r=5e3),u===void 0&&(u=100),c===void 0&&(c=100),d===void 0&&(d=0),f===void 0&&(f="frequency"),h===void 0&&(h=44100),this.algorithms.SprModelAnal(i,t,o,e,s,n,r,u,c,d,f,h)},a.prototype.SprModelSynth=function(i,t,o,e,s,n,r){return s===void 0&&(s=2048),n===void 0&&(n=512),r===void 0&&(r=44100),this.algorithms.SprModelSynth(i,t,o,e,s,n,r)},a.prototype.SpsModelAnal=function(i,t,o,e,s,n,r,u,c,d,f,h,l){return t===void 0&&(t=2048),o===void 0&&(o=20),e===void 0&&(e=.01),s===void 0&&(s=512),n===void 0&&(n=0),r===void 0&&(r=5e3),u===void 0&&(u=100),c===void 0&&(c=100),d===void 0&&(d=0),f===void 0&&(f="frequency"),h===void 0&&(h=44100),l===void 0&&(l=.2),this.algorithms.SpsModelAnal(i,t,o,e,s,n,r,u,c,d,f,h,l)},a.prototype.SpsModelSynth=function(i,t,o,e,s,n,r,u){return s===void 0&&(s=2048),n===void 0&&(n=512),r===void 0&&(r=44100),u===void 0&&(u=.2),this.algorithms.SpsModelSynth(i,t,o,e,s,n,r,u)},a.prototype.StartStopCut=function(i,t,o,e,s,n,r){return t===void 0&&(t=256),o===void 0&&(o=256),e===void 0&&(e=10),s===void 0&&(s=10),n===void 0&&(n=44100),r===void 0&&(r=-60),this.algorithms.StartStopCut(i,t,o,e,s,n,r)},a.prototype.StartStopSilence=function(i,t){return t===void 0&&(t=-60),this.algorithms.StartStopSilence(i,t)},a.prototype.StochasticModelAnal=function(i,t,o,e,s){return t===void 0&&(t=2048),o===void 0&&(o=512),e===void 0&&(e=44100),s===void 0&&(s=.2),this.algorithms.StochasticModelAnal(i,t,o,e,s)},a.prototype.StochasticModelSynth=function(i,t,o,e,s){return t===void 0&&(t=2048),o===void 0&&(o=512),e===void 0&&(e=44100),s===void 0&&(s=.2),this.algorithms.StochasticModelSynth(i,t,o,e,s)},a.prototype.StrongDecay=function(i,t){return t===void 0&&(t=44100),this.algorithms.StrongDecay(i,t)},a.prototype.StrongPeak=function(i){return this.algorithms.StrongPeak(i)},a.prototype.SuperFluxExtractor=function(i,t,o,e,s,n,r){return t===void 0&&(t=20),o===void 0&&(o=2048),e===void 0&&(e=256),s===void 0&&(s=16),n===void 0&&(n=44100),r===void 0&&(r=.05),this.algorithms.SuperFluxExtractor(i,t,o,e,s,n,r)},a.prototype.SuperFluxNovelty=function(i,t,o){return t===void 0&&(t=3),o===void 0&&(o=2),this.algorithms.SuperFluxNovelty(i,t,o)},a.prototype.SuperFluxPeaks=function(i,t,o,e,s,n,r){return t===void 0&&(t=30),o===void 0&&(o=172),e===void 0&&(e=100),s===void 0&&(s=30),n===void 0&&(n=16),r===void 0&&(r=.05),this.algorithms.SuperFluxPeaks(i,t,o,e,s,n,r)},a.prototype.TCToTotal=function(i){return this.algorithms.TCToTotal(i)},a.prototype.TempoScaleBands=function(i,t,o){t===void 0&&(t=[2,3,2,1,1.20000004768,2,3,2.5]),o===void 0&&(o=512);for(var e=new this.module.VectorFloat,s=0;s<e.size();s++)e.push_back(t[s]);return this.algorithms.TempoScaleBands(i,e,o)},a.prototype.TempoTap=function(i,t,o,e,s,n,r,u){t===void 0&&(t=1024),o===void 0&&(o=256),e===void 0&&(e=208),s===void 0&&(s=40),n===void 0&&(n=1024),r===void 0&&(r=44100),u===void 0&&(u=[]);for(var c=new this.module.VectorFloat,d=0;d<c.size();d++)c.push_back(u[d]);return this.algorithms.TempoTap(i,t,o,e,s,n,r,c)},a.prototype.TempoTapDegara=function(i,t,o,e,s){return t===void 0&&(t=208),o===void 0&&(o=40),e===void 0&&(e="none"),s===void 0&&(s=86.1328),this.algorithms.TempoTapDegara(i,t,o,e,s)},a.prototype.TempoTapMaxAgreement=function(i){return this.algorithms.TempoTapMaxAgreement(i)},a.prototype.TempoTapTicks=function(i,t,o,e,s){return o===void 0&&(o=512),e===void 0&&(e=256),s===void 0&&(s=44100),this.algorithms.TempoTapTicks(i,t,o,e,s)},a.prototype.TensorflowInputMusiCNN=function(i){return this.algorithms.TensorflowInputMusiCNN(i)},a.prototype.TensorflowInputVGGish=function(i){return this.algorithms.TensorflowInputVGGish(i)},a.prototype.TonalExtractor=function(i,t,o,e){return t===void 0&&(t=4096),o===void 0&&(o=2048),e===void 0&&(e=440),this.algorithms.TonalExtractor(i,t,o,e)},a.prototype.TonicIndianArtMusic=function(i,t,o,e,s,n,r,u,c,d,f,h,l){return t===void 0&&(t=10),o===void 0&&(o=2048),e===void 0&&(e=.85),s===void 0&&(s=512),n===void 0&&(n=1),r===void 0&&(r=40),u===void 0&&(u=375),c===void 0&&(c=100),d===void 0&&(d=20),f===void 0&&(f=5),h===void 0&&(h=55),l===void 0&&(l=44100),this.algorithms.TonicIndianArtMusic(i,t,o,e,s,n,r,u,c,d,f,h,l)},a.prototype.TriangularBands=function(i,t,o,e,s,n,r,u){t===void 0&&(t=[21.533203125,43.06640625,64.599609375,86.1328125,107.666015625,129.19921875,150.732421875,172.265625,193.798828125,215.33203125,236.865234375,258.3984375,279.931640625,301.46484375,322.998046875,344.53125,366.064453125,387.59765625,409.130859375,430.6640625,452.197265625,473.73046875,495.263671875,516.796875,538.330078125,559.86328125,581.396484375,602.9296875,624.462890625,645.99609375,667.529296875,689.0625,710.595703125,732.12890625,753.662109375,775.1953125,796.728515625,839.794921875,861.328125,882.861328125,904.39453125,925.927734375,968.994140625,990.52734375,1012.06054688,1055.12695312,1076.66015625,1098.19335938,1141.25976562,1184.32617188,1205.859375,1248.92578125,1270.45898438,1313.52539062,1356.59179688,1399.65820312,1442.72460938,1485.79101562,1528.85742188,1571.92382812,1614.99023438,1658.05664062,1701.12304688,1765.72265625,1808.7890625,1873.38867188,1916.45507812,1981.0546875,2024.12109375,2088.72070312,2153.3203125,2217.91992188,2282.51953125,2347.11914062,2411.71875,2497.8515625,2562.45117188,2627.05078125,2713.18359375,2799.31640625,2885.44921875,2950.04882812,3036.18164062,3143.84765625,3229.98046875,3316.11328125,3423.77929688,3509.91210938,3617.578125,3725.24414062,3832.91015625,3940.57617188,4069.77539062,4177.44140625,4306.640625,4435.83984375,4565.0390625,4694.23828125,4844.97070312,4974.16992188,5124.90234375,5275.63476562,5426.3671875,5577.09960938,5749.36523438,5921.63085938,6093.89648438,6266.16210938,6459.9609375,6653.75976562,6847.55859375,7041.35742188,7256.68945312,7450.48828125,7687.35351562,7902.68554688,8139.55078125,8376.41601562,8613.28125,8871.6796875,9130.078125,9388.4765625,9668.40820312,9948.33984375,10249.8046875,10551.2695312,10852.734375,11175.7324219,11498.7304688,11843.2617188,12187.7929688,12553.8574219,12919.921875,13285.9863281,13673.5839844,14082.7148438,14491.8457031,14922.5097656,15353.1738281,15805.3710938,16257.5683594]),o===void 0&&(o=1025),e===void 0&&(e=!0),s===void 0&&(s="unit_sum"),n===void 0&&(n=44100),r===void 0&&(r="power"),u===void 0&&(u="linear");for(var c=new this.module.VectorFloat,d=0;d<c.size();d++)c.push_back(t[d]);return this.algorithms.TriangularBands(i,c,o,e,s,n,r,u)},a.prototype.TriangularBarkBands=function(i,t,o,e,s,n,r,u,c,d){return t===void 0&&(t=22050),o===void 0&&(o=1025),e===void 0&&(e=!1),s===void 0&&(s=0),n===void 0&&(n="unit_sum"),r===void 0&&(r=24),u===void 0&&(u=44100),c===void 0&&(c="power"),d===void 0&&(d="warping"),this.algorithms.TriangularBarkBands(i,t,o,e,s,n,r,u,c,d)},a.prototype.Trimmer=function(i,t,o,e,s){return t===void 0&&(t=!1),o===void 0&&(o=1e6),e===void 0&&(e=44100),s===void 0&&(s=0),this.algorithms.Trimmer(i,t,o,e,s)},a.prototype.Tristimulus=function(i,t){return this.algorithms.Tristimulus(i,t)},a.prototype.TruePeakDetector=function(i,t,o,e,s,n,r,u){return t===void 0&&(t=!1),o===void 0&&(o=!1),e===void 0&&(e=4),s===void 0&&(s=1),n===void 0&&(n=44100),r===void 0&&(r=-2e-4),u===void 0&&(u=4),this.algorithms.TruePeakDetector(i,t,o,e,s,n,r,u)},a.prototype.TuningFrequency=function(i,t,o){return o===void 0&&(o=1),this.algorithms.TuningFrequency(i,t,o)},a.prototype.TuningFrequencyExtractor=function(i,t,o){return t===void 0&&(t=4096),o===void 0&&(o=2048),this.algorithms.TuningFrequencyExtractor(i,t,o)},a.prototype.UnaryOperator=function(i,t,o,e){return t===void 0&&(t=1),o===void 0&&(o=0),e===void 0&&(e="identity"),this.algorithms.UnaryOperator(i,t,o,e)},a.prototype.UnaryOperatorStream=function(i,t,o,e){return t===void 0&&(t=1),o===void 0&&(o=0),e===void 0&&(e="identity"),this.algorithms.UnaryOperatorStream(i,t,o,e)},a.prototype.Variance=function(i){return this.algorithms.Variance(i)},a.prototype.Vibrato=function(i,t,o,e,s,n){return t===void 0&&(t=250),o===void 0&&(o=8),e===void 0&&(e=50),s===void 0&&(s=4),n===void 0&&(n=344.531),this.algorithms.Vibrato(i,t,o,e,s,n)},a.prototype.WarpedAutoCorrelation=function(i,t,o){return t===void 0&&(t=1),o===void 0&&(o=44100),this.algorithms.WarpedAutoCorrelation(i,t,o)},a.prototype.Welch=function(i,t,o,e,s,n,r){return t===void 0&&(t=10),o===void 0&&(o=1024),e===void 0&&(e=512),s===void 0&&(s=44100),n===void 0&&(n="density"),r===void 0&&(r="hann"),this.algorithms.Welch(i,t,o,e,s,n,r)},a.prototype.Windowing=function(i,t,o,e,s,n){return t===void 0&&(t=!0),o===void 0&&(o=1024),e===void 0&&(e="hann"),s===void 0&&(s=0),n===void 0&&(n=!0),this.algorithms.Windowing(i,t,o,e,s,n)},a.prototype.ZeroCrossingRate=function(i,t){return t===void 0&&(t=0),this.algorithms.ZeroCrossingRate(i,t)},a}();class A{constructor(i={}){this.audioContext=null,this.analyser=null,this.microphone=null,this.stream=null,this.essentia=null,this.isListening=!1,this.animationFrame=null,this.fftSize=i.fftSize||4096,this.sampleRate=44100,this.sensitivity=i.sensitivity||.7,this.cooldownTime=i.cooldownTime||150,this.lastDetectionTime=0,this.onNoteDetectedCallback=null,this.onErrorCallback=null,this.tongueFrequencies={},this.audioBuffer=new Float32Array(this.fftSize),this.bufferIndex=0,this.bufferFilled=!1,this.lastWebAudioAnalysis=0,this.webAudioThrottleMs=50,this.essentiaInitialized=!1,this.essentiaInitializing=!1}async initializeEssentia(){if(this.essentiaInitializing||this.essentiaInitialized)return this.essentiaInitialized;this.essentiaInitializing=!0;try{if(console.log("ðŸŽµ Initializing EssentiaJS for professional audio analysis..."),this.essentia=new m,this.essentia&&typeof this.essentia.Windowing=="function")return console.log("âœ… EssentiaJS successfully initialized!"),this.essentiaInitialized=!0,this.essentiaInitializing=!1,!0;throw new Error("EssentiaJS methods not available")}catch(i){return console.warn("âš ï¸ EssentiaJS initialization failed, using Web Audio API fallback:",i),this.essentia=null,this.essentiaInitialized=!1,this.essentiaInitializing=!1,!1}}onNoteDetected(i){this.onNoteDetectedCallback=i}onError(i){this.onErrorCallback=i}updateTongueFrequencies(i){this.tongueFrequencies={...i}}setSensitivity(i){this.sensitivity=Math.max(0,Math.min(1,i))}async startListening(){if(!this.isListening)try{this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,sampleRate:this.sampleRate,channelCount:1}}),this.audioContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:this.sampleRate}),this.microphone=this.audioContext.createMediaStreamSource(this.stream),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.fftSize,this.analyser.smoothingTimeConstant=.3,this.analyser.minDecibels=-90,this.analyser.maxDecibels=-10,this.processor=this.audioContext.createScriptProcessor(1024,1,1),this.processor.onaudioprocess=i=>{this.processAudioFrame(i.inputBuffer.getChannelData(0))},this.microphone.connect(this.analyser),this.microphone.connect(this.processor),this.processor.connect(this.audioContext.destination),this.isListening=!0,console.log("Audio listening started")}catch(i){throw console.error("Failed to start audio listening:",i),this.onErrorCallback&&this.onErrorCallback(`Microphone access failed: ${i.message}`),i}}processAudioFrame(i){if(this.isListening)if(this.essentia){const t=Math.min(i.length,this.audioBuffer.length-this.bufferIndex);for(let o=0;o<t;o++)this.audioBuffer[this.bufferIndex+o]=i[o];this.bufferIndex+=t,this.bufferIndex>=this.audioBuffer.length&&(this.bufferFilled=!0,this.bufferIndex=0,this.analyzeAudioBuffer())}else{const t=Date.now();t-this.lastWebAudioAnalysis>=this.webAudioThrottleMs&&(this.lastWebAudioAnalysis=t,this.analyzeWithWebAudio())}}analyzeAudioBuffer(){if(this.bufferFilled)try{this.essentia?this.analyzeWithEssentia():this.analyzeWithWebAudio()}catch(i){console.warn("Audio analysis error:",i),this.analyzeWithWebAudio()}}analyzeWithEssentia(){try{const i=this.essentia.Windowing(this.audioBuffer,"hann"),t=this.essentia.Spectrum(i),o=this.essentia.PitchYin(this.audioBuffer,.15);let e=null;try{e=this.essentia.PitchYinFFT(this.audioBuffer,4096,.15)}catch(r){console.log("PitchYinFFT not available, using PitchYin only")}const s=this.essentia.SpectralPeaks(t);let n=o;e&&Math.abs(e-o)<20?n=(o+e)/2:e&&o===0&&(n=e),n&&n>50&&n<2e3&&this.processPitchDetection(n,{frequency:s.frequency||[],magnitude:s.magnitude||[],confidence:.8})}catch(i){console.warn("EssentiaJS analysis failed, falling back to Web Audio API:",i),this.analyzeWithWebAudio()}}analyzeWithWebAudio(){const i=this.analyser.frequencyBinCount,t=new Uint8Array(i);this.analyser.getByteFrequencyData(t);let o=0,e=0;for(let n=0;n<i;n++)t[n]>e&&(e=t[n],o=n);const s=o*this.audioContext.sampleRate/(this.analyser.fftSize*2);e>50&&s>50&&s<2e3&&this.processPitchDetection(s,{confidence:e/255})}combinePitchEstimates(i,t,o){const e=[];if(i>0&&e.push(i),t>0&&e.push(t),o.frequency.length>0){const n=o.frequency[0];n>50&&n<2e3&&e.push(n)}if(e.length===0)return null;e.sort((n,r)=>n-r);const s=Math.floor(e.length/2);return e.length%2===0?(e[s-1]+e[s])/2:e[s]}processPitchDetection(i,t){const o=Date.now();if(o-this.lastDetectionTime<this.cooldownTime)return;const e=this.findClosestTongue(i,t);e&&e.confidence>=this.sensitivity&&(this.lastDetectionTime=o,this.onNoteDetectedCallback&&this.onNoteDetectedCallback(e))}findClosestTongue(i,t){if(Object.keys(this.tongueFrequencies).length===0)return null;let o=null,e=1/0;for(const[s,n]of Object.entries(this.tongueFrequencies)){const r=parseInt(s),u=Math.abs(i-n),c=u/n;let d=.06;n>800&&(d=.08),n>1200&&(d=.1),this.checkHarmonicSupport(n,t)&&(d+=.02),c<=d&&u<e&&(e=u,o={tongue:r,frequency:i,targetFrequency:n,confidence:Math.max(0,1-c/d)})}return o}checkHarmonicSupport(i,t){if(!t.frequency||t.frequency.length<2)return!1;const o=i*2,e=i*3,s=.1;for(const n of t.frequency){const r=Math.abs(n-o)/o,u=Math.abs(n-e)/e;if(r<=s||u<=s)return!0}return!1}stopListening(){this.isListening&&(this.isListening=!1,this.processor&&(this.processor.disconnect(),this.processor=null),this.microphone&&(this.microphone.disconnect(),this.microphone=null),this.analyser&&(this.analyser.disconnect(),this.analyser=null),this.stream&&(this.stream.getTracks().forEach(i=>i.stop()),this.stream=null),this.audioContext&&this.audioContext.state!=="closed"&&(this.audioContext.close(),this.audioContext=null),console.log("Audio listening stopped"))}async testMicrophone(){try{const i=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:this.sampleRate,channelCount:1}});return setTimeout(()=>{i.getTracks().forEach(t=>t.stop())},1e3),!0}catch(i){return console.error("Microphone test failed:",i),!1}}getAudioContextState(){return this.audioContext?this.audioContext.state:"closed"}getSampleRate(){return this.audioContext?this.audioContext.sampleRate:this.sampleRate}}const L={major:[0,2,4,5,7,9,11],minor:[0,2,3,5,7,8,10],pentatonic:[0,2,4,7,9],minorPentatonic:[0,3,5,7,10],dorian:[0,2,3,5,7,9,10],mixolydian:[0,2,4,5,7,9,10],lydian:[0,2,4,6,7,9,11],akebono:[0,2,3,7,8],hijaz:[0,1,4,5,7,8,11]},P={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11},I={"D Major 15-note":{noteCount:15,key:"D",scaleType:"major",rootOctave:4,layout:null},"G Minor 13-note":{noteCount:13,key:"G",scaleType:"minor",rootOctave:4,layout:null},"C Pentatonic 11-note":{noteCount:11,key:"C",scaleType:"pentatonic",rootOctave:4,layout:null},"A Minor Pentatonic 9-note":{noteCount:9,key:"A",scaleType:"minorPentatonic",rootOctave:4,layout:null},"F Akebono 8-note":{noteCount:8,key:"F",scaleType:"akebono",rootOctave:4,layout:null}};class b{constructor(i={}){this.config={noteCount:i.noteCount||15,key:i.key||"D",scaleType:i.scaleType||"major",rootOctave:i.rootOctave||4},this.customLayouts=new Map,this.loadPresetsFromStorage()}updateConfig(i){this.config={...this.config,...i}}getConfig(){return{...this.config}}getTongueFrequency(i){if(i<1||i>this.config.noteCount)return null;const t=this.getNoteFrequency(this.config.key,this.config.rootOctave),o=L[this.config.scaleType]||L.major,e=(i-1)%o.length,s=Math.floor((i-1)/o.length),n=o[e]+s*12;return t*Math.pow(2,n/12)}getTongueFrequencies(){const i={};for(let t=1;t<=this.config.noteCount;t++)i[t]=this.getTongueFrequency(t);return i}getNoteFrequency(i,t){const o=P[i]||0,e=(t-4)*12+o-9;return 440*Math.pow(2,e/12)}generateDefaultLayout(){const i={};for(let s=1;s<=this.config.noteCount;s++){const n=2*Math.PI*(s-1)/this.config.noteCount-Math.PI/2,r=300+Math.cos(n)*200,u=300+Math.sin(n)*200;i[s]={x:r,y:u}}return{name:`Default ${this.config.noteCount}-Note Layout`,positions:i}}loadPreset(i){const t=I[i];return t?(this.updateConfig({noteCount:t.noteCount,key:t.key,scaleType:t.scaleType,rootOctave:t.rootOctave}),t.layout):(console.warn(`Preset "${i}" not found`),null)}saveCustomLayout(i){this.customLayouts.set(i.name,i),this.savePresetsToStorage()}getCustomLayout(i){return this.customLayouts.get(i)}getAllPresets(){const i={...I};for(const[t,o]of this.customLayouts)i[t]={noteCount:this.config.noteCount,key:this.config.key,scaleType:this.config.scaleType,rootOctave:this.config.rootOctave,layout:o};return i}getDrumInfo(){const i=this.config.scaleType.charAt(0).toUpperCase()+this.config.scaleType.slice(1);return`${this.config.noteCount}-Note ${this.config.key} ${i}`}getTongueNoteName(i){if(i<1||i>this.config.noteCount)return"Invalid";const t=L[this.config.scaleType]||L.major,o=(i-1)%t.length,e=Math.floor((i-1)/t.length),s=P[this.config.key]||0,n=(s+t[o])%12,r=this.config.rootOctave+e+Math.floor((s+t[o])/12);return`${["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][n]}${r}`}analyzeFrequency(i){const o=Math.round(12*Math.log2(i/440)),e=440*Math.pow(2,o/12),s=Math.round(1200*Math.log2(i/e)),n=(o+9)%12,r=4+Math.floor((o+9)/12),c=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][n<0?n+12:n];return{frequency:i,closestNote:`${c}${r}`,closestFrequency:e,centsOff:s,inTune:Math.abs(s)<=10}}validateSequence(i){if(!i||i.length===0)return{valid:!1,reason:"Empty sequence"};for(const t of i){const o=typeof t=="object"?t.tongue:t;if(o<1||o>this.config.noteCount)return{valid:!1,reason:`Invalid tongue number: ${o}`}}for(let t=1;t<i.length;t++){const o=typeof i[t-1]=="object"?i[t-1].tongue:i[t-1],e=typeof i[t]=="object"?i[t].tongue:i[t],s=this.getTongueFrequency(o),n=this.getTongueFrequency(e);if(Math.abs(Math.log2(n/s))>2)return{valid:!1,reason:`Large melodic jump between tongues ${o} and ${e}`}}return{valid:!0}}savePresetsToStorage(){try{const i={};for(const[t,o]of this.customLayouts)i[t]=o;localStorage.setItem("tongueDrumCustomLayouts",JSON.stringify(i))}catch(i){console.warn("Failed to save custom layouts to storage:",i)}}loadPresetsFromStorage(){try{const i=localStorage.getItem("tongueDrumCustomLayouts");if(i){const t=JSON.parse(i);for(const[o,e]of Object.entries(t))this.customLayouts.set(o,e)}}catch(i){console.warn("Failed to load custom layouts from storage:",i)}}exportConfig(){return{config:this.config,customLayouts:Object.fromEntries(this.customLayouts),timestamp:new Date().toISOString()}}importConfig(i){try{if(i.config&&this.updateConfig(i.config),i.customLayouts){this.customLayouts.clear();for(const[t,o]of Object.entries(i.customLayouts))this.customLayouts.set(t,o);this.savePresetsToStorage()}return!0}catch(t){return console.error("Failed to import configuration:",t),!1}}}class S{constructor(i){if(this.container=i,this.drumElement=i.querySelector("#drumVisual"),this.centerElement=i.querySelector("#centerNote"),!this.drumElement||!this.centerElement)throw new Error("Required drum elements not found");this.configManager=new b({noteCount:15,key:"D",scaleType:"major",rootOctave:4}),this.customLayout=null,this.onTongueClick=null,this.updateDrumVisual()}updateConfiguration(i){this.configManager.updateConfig(i),this.updateDrumVisual()}setCustomLayout(i){this.customLayout=i,this.updateDrumVisual()}onTongueClicked(i){this.onTongueClick=i}highlightTongue(i,t=500){const o=this.drumElement.querySelector(`[data-tongue="${i}"]`);o&&(this.clearHighlights(),o.classList.add("playing"),setTimeout(()=>{o.classList.remove("playing")},t))}showNextTongue(i){this.drumElement.querySelectorAll(".tongue").forEach(o=>{o.classList.remove("next")});const t=this.drumElement.querySelector(`[data-tongue="${i}"]`);t&&t.classList.add("next")}clearHighlights(){this.drumElement.querySelectorAll(".tongue").forEach(i=>{i.classList.remove("playing","next")})}getConfiguration(){return this.configManager.getConfig()}getTongueFrequencies(){return this.configManager.getTongueFrequencies()}updateDrumVisual(){const i=this.configManager.getConfig();this.drumElement.className=`drum-visual drum-${i.noteCount}`,this.centerElement.className=`center-note center-${i.noteCount}`,this.centerElement.textContent="0",this.drumElement.querySelectorAll(".tongue, .draggable-tongue").forEach(o=>o.remove()),this.customLayout?this.generateCustomLayout():this.generateCircularLayout()}generateCustomLayout(){if(!this.customLayout)return;const i=this.configManager.getConfig(),t=this.customLayout.positions;for(let o=1;o<=i.noteCount;o++){const e=document.createElement("div");if(e.className=`tongue tongue-${i.noteCount}`,e.dataset.tongue=o.toString(),e.textContent=o.toString(),t[o]){const s=this.drumElement.getBoundingClientRect(),n=s.width||500,r=s.height||500,u=600,c=600,d=n/u,f=r/c,h=t[o].x*d,l=t[o].y*f;e.style.position="absolute",e.style.left=h+"px",e.style.top=l+"px"}else this.positionTongueCircularly(e,o,i.noteCount);e.addEventListener("click",()=>{this.onTongueClick&&this.onTongueClick(o)}),this.drumElement.appendChild(e)}}generateCircularLayout(){const i=this.configManager.getConfig();for(let t=1;t<=i.noteCount;t++){const o=document.createElement("div");o.className=`tongue tongue-${i.noteCount}`,o.dataset.tongue=t.toString(),o.textContent=t.toString(),this.positionTongueCircularly(o,t,i.noteCount),o.addEventListener("click",()=>{this.onTongueClick&&this.onTongueClick(t)}),this.drumElement.appendChild(o)}}positionTongueCircularly(i,t,o){const e=this.drumElement.getBoundingClientRect(),s=Math.max(e.width,e.height)/2-50,n=2*Math.PI*(t-1)/o-Math.PI/2,r=Math.cos(n)*s,u=Math.sin(n)*s;i.style.position="absolute",i.style.left=`calc(50% + ${r}px - 22px)`,i.style.top=`calc(50% + ${u}px - 35px)`}resize(){this.customLayout||this.updateDrumVisual()}getDrumInfo(){return this.configManager.getDrumInfo()}simulateNoteDetection(i){const t=this.configManager.getTongueFrequency(i);if(!t)return null;const o={tongue:i,confidence:.95,frequency:t,targetFrequency:t};return this.highlightTongue(i),o}loadPreset(i){const t=this.configManager.loadPreset(i);return t?this.setCustomLayout(t):this.setCustomLayout(null),this.updateDrumVisual(),!0}getTongueNoteName(i){return this.configManager.getTongueNoteName(i)}getAllPresets(){return this.configManager.getAllPresets()}showDetectionFeedback(i){this.highlightTongue(i.tongue,400);const t=this.drumElement.querySelector(`[data-tongue="${i.tongue}"]`);if(t&&i.confidence){const o=document.createElement("div");o.className="confidence-indicator",o.style.width=`${i.confidence*100}%`,t.appendChild(o),setTimeout(()=>{o.remove()},400)}}showFrequencyAnalysis(i){const t=this.configManager.analyzeFrequency(i),o=document.createElement("div");o.className="frequency-analysis",o.innerHTML=`
      <div class="detected-freq">${i.toFixed(1)} Hz</div>
      <div class="closest-note">${t.closestNote}</div>
      <div class="cents-off ${t.inTune?"in-tune":"out-of-tune"}">
        ${t.centsOff>0?"+":""}${t.centsOff} cents
      </div>
    `,this.container.appendChild(o),setTimeout(()=>{o.remove()},2e3)}exportDrumState(){return{configuration:this.getConfiguration(),customLayout:this.customLayout,drumInfo:this.getDrumInfo(),tongueFrequencies:this.getTongueFrequencies()}}importDrumState(i){return i.configuration&&this.updateConfiguration(i.configuration),i.customLayout&&this.setCustomLayout(i.customLayout),!0}}class N{constructor(i,t){if(this.container=i,this.drumConfig=t,this.selectorGrid=i.querySelector("#tongueSelector"),this.sequenceContainer=i.querySelector("#sequenceContainer"),this.playButton=i.querySelector("#playSequence"),this.clearButton=i.querySelector("#clearSequence"),this.exportButton=i.querySelector("#exportSequence"),this.closeButton=i.querySelector("#closeBuilder"),!this.selectorGrid||!this.sequenceContainer||!this.playButton||!this.clearButton||!this.exportButton||!this.closeButton)throw new Error("Required notation builder elements not found");this.sequence=[],this.isPlaying=!1,this.onSequenceChange=null,this.onSequenceExport=null,this.onClose=null,this.onTonguePlay=null,this.setupEventListeners(),this.createTongueSelector(),this.updateSequenceDisplay()}setupEventListeners(){this.playButton.addEventListener("click",()=>this.playSequence()),this.clearButton.addEventListener("click",()=>this.clearSequence()),this.exportButton.addEventListener("click",()=>this.exportSequence()),this.closeButton.addEventListener("click",()=>this.close())}updateConfiguration(i){this.drumConfig=i,this.createTongueSelector()}onSequenceChanged(i){this.onSequenceChange=i}onSequenceExported(i){this.onSequenceExport=i}onBuilderClosed(i){this.onClose=i}onTonguePlayback(i){this.onTonguePlay=i}createTongueSelector(){this.selectorGrid.innerHTML="";for(let i=1;i<=this.drumConfig.noteCount;i++){const t=document.createElement("div");t.className="selector-tongue",t.innerHTML=`
        <div class="tongue-number">${i}</div>
        <div class="octave-controls">
          <div class="octave-btn" data-octave="high" title="High octave">â†‘</div>
          <div class="octave-btn active" data-octave="middle" title="Middle octave">â€¢</div>
          <div class="octave-btn" data-octave="low" title="Low octave">â†“</div>
        </div>
      `,t.addEventListener("click",o=>{const e=o.target;e.classList.contains("octave-btn")?this.setOctaveForTongue(t,e.dataset.octave):e.closest(".octave-controls")||this.addNoteToSequence(i,this.getSelectedOctave(t))}),this.selectorGrid.appendChild(t)}}setOctaveForTongue(i,t){var o;i.querySelectorAll(".octave-btn").forEach(e=>{e.classList.remove("active")}),(o=i.querySelector(`[data-octave="${t}"]`))==null||o.classList.add("active")}getSelectedOctave(i){const t=i.querySelector(".octave-btn.active");return(t==null?void 0:t.dataset.octave)||"middle"}addNoteToSequence(i,t){const o={tongue:i,octave:t};this.sequence.push(o),this.updateSequenceDisplay(),this.onSequenceChange&&this.onSequenceChange([...this.sequence]),this.onTonguePlay&&this.onTonguePlay(i)}removeNoteFromSequence(i){i>=0&&i<this.sequence.length&&(this.sequence.splice(i,1),this.updateSequenceDisplay(),this.onSequenceChange&&this.onSequenceChange([...this.sequence]))}updateSequenceDisplay(){if(this.sequence.length===0){this.sequenceContainer.innerHTML='<div class="empty-sequence">Click tongue numbers above to start building your song!</div>';return}this.sequenceContainer.innerHTML="",this.sequence.forEach((i,t)=>{const o=document.createElement("div");o.className="sequence-note";const e=i.octave==="high"?'<div class="note-octave high">â€¢</div>':i.octave==="low"?'<div class="note-octave low">â€¢</div>':"";o.innerHTML=`
        <div class="note-number">${i.tongue}</div>
        ${e}
        <button class="note-remove" data-index="${t}">Ã—</button>
      `,o.querySelector(".note-remove").addEventListener("click",n=>{n.stopPropagation(),this.removeNoteFromSequence(t)}),this.sequenceContainer.appendChild(o)})}async playSequence(){if(this.sequence.length===0){alert("Please add some notes to the sequence first!");return}if(!this.isPlaying){this.isPlaying=!0,this.playButton.textContent="â¸ï¸ Playing...",this.playButton.setAttribute("disabled","true");try{for(let t=0;t<this.sequence.length;t++){const o=this.sequence[t],e=this.sequenceContainer.querySelectorAll(".sequence-note");e.forEach(s=>s.classList.remove("playing")),e[t]&&e[t].classList.add("playing"),this.onTonguePlay&&this.onTonguePlay(o.tongue),await new Promise(s=>setTimeout(s,600))}this.sequenceContainer.querySelectorAll(".sequence-note").forEach(t=>t.classList.remove("playing"))}finally{this.isPlaying=!1,this.playButton.textContent="â–¶ï¸ Play Sequence",this.playButton.removeAttribute("disabled")}}}clearSequence(){this.sequence=[],this.updateSequenceDisplay(),this.onSequenceChange&&this.onSequenceChange([])}exportSequence(){if(this.sequence.length===0){alert("Please add some notes to the sequence first!");return}this.onSequenceExport&&this.onSequenceExport([...this.sequence])}close(){this.onClose&&this.onClose()}setVisible(i){this.container.style.display=i?"block":"none"}getSequence(){return[...this.sequence]}setSequence(i){this.sequence=[...i],this.updateSequenceDisplay(),this.onSequenceChange&&this.onSequenceChange([...this.sequence])}sequenceToNotation(){return this.sequence.map(i=>i.octave==="high"?`${i.tongue}^`:i.octave==="low"?`${i.tongue}v`:i.tongue)}static notationToSequence(i){return i.map(t=>typeof t=="string"?t.endsWith("^")?{tongue:parseInt(t.slice(0,-1)),octave:"high"}:t.endsWith("v")?{tongue:parseInt(t.slice(0,-1)),octave:"low"}:{tongue:parseInt(t),octave:"middle"}:{tongue:t,octave:"middle"})}generateRandomSequence(i=8){this.clearSequence();for(let t=0;t<i;t++){const o=Math.floor(Math.random()*this.drumConfig.noteCount)+1,e=["low","middle","high"],s=e[Math.floor(Math.random()*e.length)];this.addNoteToSequence(o,s)}}importSequence(i){try{let t;if(typeof i=="string")t=JSON.parse(i);else if(Array.isArray(i))t=i;else throw new Error("Invalid sequence format");if(!Array.isArray(t))throw new Error("Sequence must be an array");for(const o of t){if(!o.tongue||o.tongue<1||o.tongue>this.drumConfig.noteCount)throw new Error(`Invalid tongue number: ${o.tongue}`);if(o.octave&&!["low","middle","high"].includes(o.octave))throw new Error(`Invalid octave: ${o.octave}`)}return this.setSequence(t),!0}catch(t){return console.error("Failed to import sequence:",t),alert(`Failed to import sequence: ${t.message}`),!1}}getSequenceStats(){if(this.sequence.length===0)return null;const i={},t={low:0,middle:0,high:0};let o=new Set;for(const e of this.sequence)i[e.tongue]=(i[e.tongue]||0)+1,t[e.octave]=(t[e.octave]||0)+1,o.add(e.tongue);return{length:this.sequence.length,uniqueTongues:o.size,tongueUsage:i,octaveUsage:t,coverage:o.size/this.drumConfig.noteCount*100}}}class k{constructor(i,t){if(this.container=i,this.drumConfig=t,this.canvas=i.querySelector("#layoutCanvas"),this.saveButton=i.querySelector("#saveLayout"),this.resetButton=i.querySelector("#resetLayout"),this.closeButton=i.querySelector("#closeLayoutBuilder"),this.nameInput=i.querySelector("#layoutName"),!this.canvas||!this.saveButton||!this.resetButton||!this.closeButton||!this.nameInput)throw new Error("Required layout builder elements not found");this.currentLayout=this.generateDefaultLayout(),this.dragState={isDragging:!1,dragElement:null,dragOffset:{x:0,y:0}},this.onLayoutSaved=null,this.onClose=null,this.setupEventListeners(),this.createDraggableTongues()}setupEventListeners(){this.saveButton.addEventListener("click",()=>this.saveLayout()),this.resetButton.addEventListener("click",()=>this.resetLayout()),this.closeButton.addEventListener("click",()=>this.close()),this.canvas.addEventListener("mousedown",i=>this.handleMouseDown(i)),this.canvas.addEventListener("mousemove",i=>this.handleMouseMove(i)),this.canvas.addEventListener("mouseup",i=>this.handleMouseUp(i)),this.canvas.addEventListener("mouseleave",i=>this.handleMouseUp(i)),this.canvas.addEventListener("touchstart",i=>this.handleTouchStart(i)),this.canvas.addEventListener("touchmove",i=>this.handleTouchMove(i)),this.canvas.addEventListener("touchend",i=>this.handleTouchEnd(i))}updateConfiguration(i){this.drumConfig=i,this.currentLayout=this.generateDefaultLayout(),this.createDraggableTongues()}onLayoutSave(i){this.onLayoutSaved=i}onBuilderClosed(i){this.onClose=i}generateDefaultLayout(){const i={},t=this.canvas.getBoundingClientRect(),o=t.width/2||300,e=t.height/2||300,s=Math.min(o,e)-60;for(let n=1;n<=this.drumConfig.noteCount;n++){const r=2*Math.PI*(n-1)/this.drumConfig.noteCount-Math.PI/2,u=o+Math.cos(r)*s,c=e+Math.sin(r)*s;i[n]={x:u,y:c}}return{name:`Custom ${this.drumConfig.noteCount}-Note Layout`,positions:i}}createDraggableTongues(){this.canvas.innerHTML="";const i=document.createElement("div");i.className="layout-center",i.textContent="0",this.canvas.appendChild(i);for(let t=1;t<=this.drumConfig.noteCount;t++){const o=document.createElement("div");o.className="draggable-tongue",o.dataset.tongue=t.toString(),o.textContent=t.toString(),o.draggable=!1;const e=this.currentLayout.positions[t];e&&(o.style.left=e.x+"px",o.style.top=e.y+"px"),this.canvas.appendChild(o)}}handleMouseDown(i){const t=i.target;t.classList.contains("draggable-tongue")&&(i.preventDefault(),this.startDrag(t,i.clientX,i.clientY))}handleMouseMove(i){!this.dragState.isDragging||!this.dragState.dragElement||(i.preventDefault(),this.updateDragPosition(i.clientX,i.clientY))}handleMouseUp(i){this.dragState.isDragging&&this.endDrag()}handleTouchStart(i){const t=i.target;if(!t.classList.contains("draggable-tongue"))return;i.preventDefault();const o=i.touches[0];this.startDrag(t,o.clientX,o.clientY)}handleTouchMove(i){if(!this.dragState.isDragging||!this.dragState.dragElement)return;i.preventDefault();const t=i.touches[0];this.updateDragPosition(t.clientX,t.clientY)}handleTouchEnd(i){this.dragState.isDragging&&this.endDrag()}startDrag(i,t,o){this.canvas.getBoundingClientRect();const e=i.getBoundingClientRect();this.dragState={isDragging:!0,dragElement:i,dragOffset:{x:t-e.left,y:o-e.top}},i.classList.add("dragging"),this.canvas.classList.add("dragging-active")}updateDragPosition(i,t){if(!this.dragState.dragElement)return;const o=this.canvas.getBoundingClientRect();let e=i-o.left-this.dragState.dragOffset.x,s=t-o.top-this.dragState.dragOffset.y;const n=44,r=70;e=Math.max(0,Math.min(e,o.width-n)),s=Math.max(0,Math.min(s,o.height-r)),this.dragState.dragElement.style.left=e+"px",this.dragState.dragElement.style.top=s+"px"}endDrag(){if(!this.dragState.dragElement)return;const i=this.dragState.dragElement,t=parseInt(i.dataset.tongue||"0");t>0&&(this.currentLayout.positions[t]={x:parseFloat(i.style.left),y:parseFloat(i.style.top)}),i.classList.remove("dragging"),this.canvas.classList.remove("dragging-active"),this.dragState={isDragging:!1,dragElement:null,dragOffset:{x:0,y:0}}}saveLayout(){const i=this.nameInput.value.trim();if(!i){alert("Please enter a name for the layout"),this.nameInput.focus();return}const t={name:i,positions:{...this.currentLayout.positions}};this.onLayoutSaved&&this.onLayoutSaved(t),alert(`Layout "${i}" saved successfully!`)}resetLayout(){confirm("Reset all tongue positions to default circular layout?")&&(this.currentLayout=this.generateDefaultLayout(),this.createDraggableTongues())}close(){this.onClose&&this.onClose()}setVisible(i){this.container.style.display=i?"block":"none",i&&(this.nameInput.value=this.currentLayout.name||"")}loadLayout(i){this.currentLayout={name:i.name,positions:{...i.positions}},this.nameInput.value=i.name,this.createDraggableTongues()}getCurrentLayout(){return{name:this.currentLayout.name,positions:{...this.currentLayout.positions}}}autoArrangePattern(i){const t=this.canvas.getBoundingClientRect(),o=t.width/2||300,e=t.height/2||300,s={};switch(i){case"circle":const n=Math.min(o,e)-60;for(let l=1;l<=this.drumConfig.noteCount;l++){const v=2*Math.PI*(l-1)/this.drumConfig.noteCount-Math.PI/2;s[l]={x:o+Math.cos(v)*n,y:e+Math.sin(v)*n}}break;case"grid":const r=Math.ceil(Math.sqrt(this.drumConfig.noteCount)),u=Math.min(t.width,t.height)/(r+1);for(let l=1;l<=this.drumConfig.noteCount;l++){const v=Math.floor((l-1)/r),g=(l-1)%r;s[l]={x:u*(g+1),y:u*(v+1)}}break;case"spiral":let c=0,d=20;const f=15;for(let l=1;l<=this.drumConfig.noteCount;l++)s[l]={x:o+Math.cos(c)*d,y:e+Math.sin(c)*d},c+=.8,d+=f;break;case"line":const h=(t.width-80)/(this.drumConfig.noteCount-1);for(let l=1;l<=this.drumConfig.noteCount;l++)s[l]={x:40+(l-1)*h,y:e};break;default:console.warn(`Unknown pattern: ${i}`);return}this.currentLayout.positions=s,this.createDraggableTongues()}exportLayout(){const i={...this.getCurrentLayout(),drumConfig:this.drumConfig,timestamp:new Date().toISOString()},t=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),o=URL.createObjectURL(t),e=document.createElement("a");e.href=o,e.download=`tongue-drum-layout-${i.name.replace(/\s+/g,"-")}.json`,e.click(),URL.revokeObjectURL(o)}importLayout(i){try{let t;if(typeof i=="string"?t=JSON.parse(i):t=i,!t.name||!t.positions)throw new Error("Invalid layout format");return this.loadLayout(t),!0}catch(t){return console.error("Failed to import layout:",t),alert(`Failed to import layout: ${t.message}`),!1}}getLayoutStats(){const i=Object.values(this.currentLayout.positions);if(i.length===0)return null;const t=i.map(e=>e.x),o=i.map(e=>e.y);return{tongueCount:i.length,bounds:{minX:Math.min(...t),maxX:Math.max(...t),minY:Math.min(...o),maxY:Math.max(...o)},center:{x:t.reduce((e,s)=>e+s,0)/t.length,y:o.reduce((e,s)=>e+s,0)/o.length}}}}class x{constructor(){this.audioManager=null,this.drumVisualizer=null,this.notationBuilder=null,this.layoutBuilder=null,this.isListening=!1,this.currentConfig={noteCount:15,key:"D",scaleType:"major",rootOctave:4},this.detectionHistory=[],this.initializeElements(),this.setupEventListeners(),this.initializeComponents(),this.updateUI()}initializeElements(){this.setupPanel=document.querySelector(".setup-panel"),this.tabButtons=document.querySelectorAll(".tab"),this.tabPanels=document.querySelectorAll(".tab-content"),this.startButton=document.getElementById("startButton"),this.stopButton=null,this.testMicButton=document.getElementById("testMicrophone"),this.sensitivitySlider=this.createSensitivityControls(),this.sensitivityValue=document.getElementById("sensitivityValue"),this.detectionResults=document.getElementById("detectionResults"),this.audioInfo=document.querySelector(".audio-metrics"),this.statusMessage=document.getElementById("status"),this.progressBar=document.getElementById("progressFill"),this.drumSizeSelect=document.getElementById("noteCount"),this.keySelect=document.getElementById("drumKey"),this.scaleSelect=document.getElementById("scaleType"),this.octaveSelect=document.getElementById("rootOctave"),this.presetSelect=this.createPresetSelect(),this.loadPresetButton=document.getElementById("applyManualConfig"),this.notationToggle=document.getElementById("toggleBuilder"),this.layoutToggle=document.getElementById("loadPhoto"),this.autoDetectButton=document.getElementById("startDetection"),[this.setupPanel,this.startButton,this.testMicButton,this.audioInfo,this.statusMessage,this.drumSizeSelect,this.keySelect,this.scaleSelect].filter(o=>!o).length>0&&console.warn("Some optional DOM elements not found, but continuing...")}createSensitivityControls(){let i=document.getElementById("sensitivitySlider");if(i)return i;const t=document.querySelector(".controls");if(t){const o=document.createElement("div");return o.className="config-group",o.innerHTML=`
        <label for="sensitivitySlider">Detection Sensitivity</label>
        <div class="slider-container">
          <input type="range" id="sensitivitySlider" min="0.1" max="1.0" step="0.1" value="0.7">
          <span id="sensitivityValue">0.7</span>
        </div>
        <small>Higher = more sensitive</small>
      `,t.appendChild(o),document.getElementById("sensitivitySlider")}return null}createPresetSelect(){let i=document.getElementById("presetSelect");if(i)return i;const t=document.getElementById("manual-tab");if(t){const o=document.createElement("div");return o.className="config-group",o.innerHTML=`
        <label for="presetSelect">Quick Presets</label>
        <select id="presetSelect">
          <option value="">-- Select a preset --</option>
          <option value="D Major 15-note">D Major 15-note</option>
          <option value="G Minor 13-note">G Minor 13-note</option>
          <option value="C Pentatonic 11-note">C Pentatonic 11-note</option>
        </select>
      `,t.appendChild(o),document.getElementById("presetSelect")}return null}setupEventListeners(){this.tabButtons.forEach(i=>{i.addEventListener("click",t=>{const e=t.target.dataset.tab;e&&this.switchTab(e)})}),this.startButton&&this.startButton.addEventListener("click",()=>this.startListening()),this.autoDetectButton&&this.autoDetectButton.addEventListener("click",()=>this.startListening()),this.testMicButton&&this.testMicButton.addEventListener("click",()=>this.testMicrophone()),this.sensitivitySlider&&this.sensitivitySlider.addEventListener("input",()=>this.updateSensitivity()),this.drumSizeSelect&&this.drumSizeSelect.addEventListener("change",()=>this.updateConfiguration()),this.keySelect&&this.keySelect.addEventListener("change",()=>this.updateConfiguration()),this.scaleSelect&&this.scaleSelect.addEventListener("change",()=>this.updateConfiguration()),this.octaveSelect&&this.octaveSelect.addEventListener("change",()=>this.updateConfiguration()),this.loadPresetButton&&this.loadPresetButton.addEventListener("click",()=>this.updateConfiguration()),this.presetSelect&&this.presetSelect.addEventListener("change",()=>this.loadPreset()),this.notationToggle&&this.notationToggle.addEventListener("click",()=>this.toggleNotationBuilder()),window.addEventListener("resize",()=>{this.drumVisualizer&&this.drumVisualizer.resize()})}initializeComponents(){try{const i=document.querySelector(".drum-container");i?(this.drumVisualizer=new S(i),this.drumVisualizer.onTongueClicked(e=>this.handleTongueClick(e))):console.warn("Drum container not found, drum visualizer not initialized");const t=document.getElementById("notationBuilder");t?(this.notationBuilder=new N(t,this.currentConfig),this.notationBuilder.onSequenceChanged(e=>this.handleSequenceChange(e)),this.notationBuilder.onSequenceExported(e=>this.exportSequence(e)),this.notationBuilder.onBuilderClosed(()=>this.toggleNotationBuilder()),this.notationBuilder.onTonguePlayback(e=>this.playTongue(e)),this.notationBuilder.setVisible(!1)):console.warn("Notation builder container not found");const o=document.getElementById("layoutBuilder");o?(this.layoutBuilder=new k(o,this.currentConfig),this.layoutBuilder.onLayoutSave(e=>this.saveCustomLayout(e)),this.layoutBuilder.onBuilderClosed(()=>this.toggleLayoutBuilder()),this.layoutBuilder.setVisible(!1)):(console.warn("Layout builder container not found - using layout tab instead"),this.setupLayoutTabFunctionality()),console.log("ðŸŽµ Components initialized successfully!")}catch(i){console.error("Failed to initialize components:",i),this.showStatus("Application partially loaded - some features may be limited","warning")}}setupLayoutTabFunctionality(){document.getElementById("layoutCanvas")&&this.drumVisualizer&&console.log("Setting up basic layout functionality in layout tab")}switchTab(i){this.tabButtons.forEach(t=>{t.classList.toggle("active",t.dataset.tab===i)}),this.tabPanels.forEach(t=>{t.classList.toggle("active",t.id===`${i}Tab`)})}async startListening(){if(!(this.isListening||this.audioManager))try{if(this.showStatus("Initializing EssentiaJS audio analysis engine...","info"),this.setProgress(10),this.audioManager=new A({fftSize:4096,sensitivity:parseFloat(this.sensitivitySlider.value)||.7,cooldownTime:150}),this.setProgress(30),this.showStatus("Loading EssentiaJS audio analysis engine...","info"),await this.audioManager.initializeEssentia()?this.showStatus("EssentiaJS loaded! Professional-grade pitch detection ready...","success"):this.showStatus("Using Web Audio API fallback for pitch detection...","info"),this.setProgress(40),this.audioManager.onNoteDetected(t=>this.handleNoteDetection(t)),this.audioManager.onError(t=>this.showStatus(t,"error")),this.setProgress(60),this.drumVisualizer){const t=this.drumVisualizer.getTongueFrequencies();this.audioManager.updateTongueFrequencies(t)}this.setProgress(70),await this.audioManager.startListening(),this.setProgress(100),this.isListening=!0,this.updateUI(),this.showStatus("EssentiaJS audio analysis active - listening for tongue drum notes...","success"),this.updateAudioInfo(),setTimeout(()=>this.setProgress(0),1e3)}catch(i){console.error("Failed to start listening:",i),this.showStatus(`Failed to start listening: ${i.message}`,"error"),this.setProgress(0),this.audioManager=null}}stopListening(){!this.isListening||!this.audioManager||(this.audioManager.stopListening(),this.audioManager=null,this.isListening=!1,this.updateUI(),this.showStatus("Audio analysis stopped","info"),this.clearDetectionResults())}async testMicrophone(){try{this.showStatus("Testing microphone access...","info");const i=new A;await i.testMicrophone()?this.showStatus("Microphone test successful! EssentiaJS ready.","success"):this.showStatus("Microphone test failed","error"),i.stopListening()}catch(i){console.error("Microphone test failed:",i),this.showStatus(`Microphone test failed: ${i.message}`,"error")}}updateSensitivity(){const i=parseFloat(this.sensitivitySlider.value);this.sensitivityValue.textContent=i.toFixed(1),this.audioManager&&this.audioManager.setSensitivity(i)}updateConfiguration(){const i={noteCount:parseInt(this.drumSizeSelect.value),key:this.keySelect.value,scaleType:this.scaleSelect.value,rootOctave:parseInt(this.octaveSelect.value)};if(this.currentConfig=i,this.drumVisualizer&&this.drumVisualizer.updateConfiguration(i),this.notationBuilder&&this.notationBuilder.updateConfiguration(i),this.layoutBuilder&&this.layoutBuilder.updateConfiguration(i),this.audioManager&&this.drumVisualizer){const t=this.drumVisualizer.getTongueFrequencies();this.audioManager.updateTongueFrequencies(t)}this.updateAudioInfo()}loadPreset(){const i=this.presetSelect.value;i&&this.drumVisualizer&&(this.drumVisualizer.loadPreset(i)?(this.showStatus(`Loaded preset: ${i}`,"success"),this.updateAudioInfo()):this.showStatus(`Failed to load preset: ${i}`,"error"))}handleNoteDetection(i){this.detectionHistory.unshift(i),this.detectionHistory.length>10&&(this.detectionHistory=this.detectionHistory.slice(0,10)),this.drumVisualizer&&this.drumVisualizer.showDetectionFeedback(i),this.updateDetectionResults(),console.log(`EssentiaJS detected: Tongue ${i.tongue}, ${i.frequency.toFixed(1)}Hz, confidence: ${(i.confidence*100).toFixed(1)}%`)}handleTongueClick(i){this.playTongue(i),this.drumVisualizer&&this.drumVisualizer.simulateNoteDetection(i)}playTongue(i){if(this.drumVisualizer){const t=this.drumVisualizer.getTongueFrequencies()[i];t&&this.synthesizeTongueNote(t,.5),this.drumVisualizer.highlightTongue(i,300)}}synthesizeTongueNote(i,t){if(!window.AudioContext&&!window.webkitAudioContext){console.warn("Web Audio API not supported");return}try{const o=new(window.AudioContext||window.webkitAudioContext),e=o.createOscillator(),s=o.createGain();e.type="sine",e.frequency.setValueAtTime(i,o.currentTime);const n=o.currentTime;s.gain.setValueAtTime(0,n),s.gain.linearRampToValueAtTime(.3,n+.01),s.gain.exponentialRampToValueAtTime(.1,n+.1),s.gain.exponentialRampToValueAtTime(.05,n+t*.7),s.gain.exponentialRampToValueAtTime(.001,n+t),e.connect(s),s.connect(o.destination),e.start(n),e.stop(n+t)}catch(o){console.warn("Failed to synthesize note:",o)}}handleSequenceChange(i){console.log("Sequence updated:",i)}exportSequence(i){var r,u;const t=((r=this.notationBuilder)==null?void 0:r.sequenceToNotation())||[],o={drumConfig:this.currentConfig,sequence:i,notation:t,tongueFrequencies:((u=this.drumVisualizer)==null?void 0:u.getTongueFrequencies())||{},timestamp:new Date().toISOString(),version:"2.0-EssentiaJS"},e=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),s=URL.createObjectURL(e),n=document.createElement("a");n.href=s,n.download=`tongue-drum-sequence-${Date.now()}.json`,n.click(),URL.revokeObjectURL(s),this.showStatus("Sequence exported successfully!","success")}saveCustomLayout(i){this.drumVisualizer&&this.drumVisualizer.configManager&&this.drumVisualizer.configManager.saveCustomLayout(i);let t=!1;for(const o of this.presetSelect.options)if(o.value===i.name){t=!0;break}if(!t){const o=document.createElement("option");o.value=i.name,o.textContent=i.name,this.presetSelect.appendChild(o)}this.showStatus(`Layout "${i.name}" saved!`,"success")}toggleNotationBuilder(){if(!this.notationBuilder)return;const t=document.getElementById("notationBuilder").style.display!=="none";this.notationBuilder.setVisible(!t),this.notationToggle.textContent=t?"ðŸŽµ Show Notation Builder":"ðŸŽµ Hide Notation Builder"}toggleLayoutBuilder(){if(!this.layoutBuilder)return;const t=document.getElementById("layoutBuilder").style.display!=="none";this.layoutBuilder.setVisible(!t),this.layoutToggle.textContent=t?"ðŸŽ¯ Show Layout Builder":"ðŸŽ¯ Hide Layout Builder"}updateUI(){this.startButton&&(this.startButton.style.display=this.isListening?"none":"inline-block",this.startButton.textContent=this.isListening?"Stop Detection":"Start Detection"),this.autoDetectButton&&(this.autoDetectButton.textContent=this.isListening?"Stop Detection":"Start Detection"),this.stopButton&&(this.stopButton.style.display=this.isListening?"inline-block":"none"),this.drumSizeSelect&&(this.drumSizeSelect.disabled=this.isListening),this.keySelect&&(this.keySelect.disabled=this.isListening),this.scaleSelect&&(this.scaleSelect.disabled=this.isListening),this.octaveSelect&&(this.octaveSelect.disabled=this.isListening)}updateAudioInfo(){if(this.drumVisualizer){const i=this.drumVisualizer.getDrumInfo(),t=this.audioManager?this.audioManager.getAudioContextState():"closed",o=this.audioManager?this.audioManager.getSampleRate():"N/A";this.audioInfo.innerHTML=`
        <div class="audio-stat">
          <span class="stat-label">Configuration:</span>
          <span class="stat-value">${i}</span>
        </div>
        <div class="audio-stat">
          <span class="stat-label">Status:</span>
          <span class="stat-value">${this.isListening?"EssentiaJS Active":"Stopped"}</span>
        </div>
        <div class="audio-stat">
          <span class="stat-label">Sample Rate:</span>
          <span class="stat-value">${o} Hz</span>
        </div>
        <div class="audio-stat">
          <span class="stat-label">Audio Context:</span>
          <span class="stat-value">${t}</span>
        </div>
      `}}updateDetectionResults(){if(this.detectionHistory.length===0){this.detectionResults.innerHTML='<div class="no-results">No notes detected yet... (EssentiaJS ready)</div>';return}const i=this.detectionHistory.map(t=>`
      <div class="detection-result">
        <span class="tongue-number">Tongue ${t.tongue}</span>
        <span class="confidence ${t.confidence>.8?"high-confidence":t.confidence>.5?"medium-confidence":"low-confidence"}">
          ${(t.confidence*100).toFixed(1)}%
        </span>
        <span class="frequency">${t.frequency.toFixed(1)} Hz</span>
        ${t.targetFrequency?`<span class="target-freq">(target: ${t.targetFrequency.toFixed(1)}Hz)</span>`:""}
      </div>
    `).join("");this.detectionResults.innerHTML=i}clearDetectionResults(){this.detectionHistory=[],this.updateDetectionResults()}showStatus(i,t="info"){this.statusMessage.textContent=i,this.statusMessage.className=`status-message ${t}`,t!=="error"&&setTimeout(()=>{this.statusMessage.textContent="",this.statusMessage.className="status-message"},5e3)}setProgress(i){this.progressBar.style.width=`${i}%`,this.progressBar.style.display=i>0?"block":"none"}}document.addEventListener("DOMContentLoaded",()=>{try{new x,console.log("ðŸŽµ Tongue Drum Chum app initialized successfully with EssentiaJS! ðŸŽµ")}catch(a){console.error("Failed to initialize Tongue Drum Chum app:",a);const i=document.getElementById("statusMessage");i&&(i.textContent=`Failed to initialize app: ${a.message}`,i.className="status-message error")}});
//# sourceMappingURL=index-ZgMUSvkK.js.map
